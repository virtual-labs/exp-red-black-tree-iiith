<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<!-- 2021-03-17 Wed 07:41 -->
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>&lrm;</title>
<meta name="generator" content="Org mode" />
<meta name="author" content="VLEAD" />
<style type="text/css">
 <!--/*--><![CDATA[/*><!--*/
  .title  { text-align: center;
             margin-bottom: .2em; }
  .subtitle { text-align: center;
              font-size: medium;
              font-weight: bold;
              margin-top:0; }
  .todo   { font-family: monospace; color: red; }
  .done   { font-family: monospace; color: green; }
  .priority { font-family: monospace; color: orange; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .org-right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .org-left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .org-center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #ccc;
    box-shadow: 3px 3px 3px #eee;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: visible;
    padding-top: 1.2em;
  }
  pre.src:before {
    display: none;
    position: absolute;
    background-color: white;
    top: -10px;
    right: 10px;
    padding: 3px;
    border: 1px solid black;
  }
  pre.src:hover:before { display: inline;}
  /* Languages per Org manual */
  pre.src-asymptote:before { content: 'Asymptote'; }
  pre.src-awk:before { content: 'Awk'; }
  pre.src-C:before { content: 'C'; }
  /* pre.src-C++ doesn't work in CSS */
  pre.src-clojure:before { content: 'Clojure'; }
  pre.src-css:before { content: 'CSS'; }
  pre.src-D:before { content: 'D'; }
  pre.src-ditaa:before { content: 'ditaa'; }
  pre.src-dot:before { content: 'Graphviz'; }
  pre.src-calc:before { content: 'Emacs Calc'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-fortran:before { content: 'Fortran'; }
  pre.src-gnuplot:before { content: 'gnuplot'; }
  pre.src-haskell:before { content: 'Haskell'; }
  pre.src-hledger:before { content: 'hledger'; }
  pre.src-java:before { content: 'Java'; }
  pre.src-js:before { content: 'Javascript'; }
  pre.src-latex:before { content: 'LaTeX'; }
  pre.src-ledger:before { content: 'Ledger'; }
  pre.src-lisp:before { content: 'Lisp'; }
  pre.src-lilypond:before { content: 'Lilypond'; }
  pre.src-lua:before { content: 'Lua'; }
  pre.src-matlab:before { content: 'MATLAB'; }
  pre.src-mscgen:before { content: 'Mscgen'; }
  pre.src-ocaml:before { content: 'Objective Caml'; }
  pre.src-octave:before { content: 'Octave'; }
  pre.src-org:before { content: 'Org mode'; }
  pre.src-oz:before { content: 'OZ'; }
  pre.src-plantuml:before { content: 'Plantuml'; }
  pre.src-processing:before { content: 'Processing.js'; }
  pre.src-python:before { content: 'Python'; }
  pre.src-R:before { content: 'R'; }
  pre.src-ruby:before { content: 'Ruby'; }
  pre.src-sass:before { content: 'Sass'; }
  pre.src-scheme:before { content: 'Scheme'; }
  pre.src-screen:before { content: 'Gnu Screen'; }
  pre.src-sed:before { content: 'Sed'; }
  pre.src-sh:before { content: 'shell'; }
  pre.src-sql:before { content: 'SQL'; }
  pre.src-sqlite:before { content: 'SQLite'; }
  /* additional languages in org.el's org-babel-load-languages alist */
  pre.src-forth:before { content: 'Forth'; }
  pre.src-io:before { content: 'IO'; }
  pre.src-J:before { content: 'J'; }
  pre.src-makefile:before { content: 'Makefile'; }
  pre.src-maxima:before { content: 'Maxima'; }
  pre.src-perl:before { content: 'Perl'; }
  pre.src-picolisp:before { content: 'Pico Lisp'; }
  pre.src-scala:before { content: 'Scala'; }
  pre.src-shell:before { content: 'Shell Script'; }
  pre.src-ebnf2ps:before { content: 'ebfn2ps'; }
  /* additional language identifiers per "defun org-babel-execute"
       in ob-*.el */
  pre.src-cpp:before  { content: 'C++'; }
  pre.src-abc:before  { content: 'ABC'; }
  pre.src-coq:before  { content: 'Coq'; }
  pre.src-groovy:before  { content: 'Groovy'; }
  /* additional language identifiers from org-babel-shell-names in
     ob-shell.el: ob-shell is the only babel language using a lambda to put
     the execution function name together. */
  pre.src-bash:before  { content: 'bash'; }
  pre.src-csh:before  { content: 'csh'; }
  pre.src-ash:before  { content: 'ash'; }
  pre.src-dash:before  { content: 'dash'; }
  pre.src-ksh:before  { content: 'ksh'; }
  pre.src-mksh:before  { content: 'mksh'; }
  pre.src-posh:before  { content: 'posh'; }
  /* Additional Emacs modes also supported by the LaTeX listings package */
  pre.src-ada:before { content: 'Ada'; }
  pre.src-asm:before { content: 'Assembler'; }
  pre.src-caml:before { content: 'Caml'; }
  pre.src-delphi:before { content: 'Delphi'; }
  pre.src-html:before { content: 'HTML'; }
  pre.src-idl:before { content: 'IDL'; }
  pre.src-mercury:before { content: 'Mercury'; }
  pre.src-metapost:before { content: 'MetaPost'; }
  pre.src-modula-2:before { content: 'Modula-2'; }
  pre.src-pascal:before { content: 'Pascal'; }
  pre.src-ps:before { content: 'PostScript'; }
  pre.src-prolog:before { content: 'Prolog'; }
  pre.src-simula:before { content: 'Simula'; }
  pre.src-tcl:before { content: 'tcl'; }
  pre.src-tex:before { content: 'TeX'; }
  pre.src-plain-tex:before { content: 'Plain TeX'; }
  pre.src-verilog:before { content: 'Verilog'; }
  pre.src-vhdl:before { content: 'VHDL'; }
  pre.src-xml:before { content: 'XML'; }
  pre.src-nxml:before { content: 'XML'; }
  /* add a generic configuration mode; LaTeX export needs an additional
     (add-to-list 'org-latex-listings-langs '(conf " ")) in .emacs */
  pre.src-conf:before { content: 'Configuration File'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.org-right  { text-align: center;  }
  th.org-left   { text-align: center;   }
  th.org-center { text-align: center; }
  td.org-right  { text-align: right;  }
  td.org-left   { text-align: left;   }
  td.org-center { text-align: center; }
  dt { font-weight: bold; }
  .footpara { display: inline; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  .org-svg { width: 90%; }
  /*]]>*/-->
</style>
<script type="text/javascript">
/*
@licstart  The following is the entire license notice for the
JavaScript code in this tag.

Copyright (C) 2012-2017 Free Software Foundation, Inc.

The JavaScript code in this tag is free software: you can
redistribute it and/or modify it under the terms of the GNU
General Public License (GNU GPL) as published by the Free Software
Foundation, either version 3 of the License, or (at your option)
any later version.  The code is distributed WITHOUT ANY WARRANTY;
without even the implied warranty of MERCHANTABILITY or FITNESS
FOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.

As additional permission under GNU GPL version 3 section 7, you
may distribute non-source (e.g., minimized or compacted) forms of
that code without the copy of the GNU GPL normally required by
section 4, provided you include this license notice and a URL
through which recipients can access the Corresponding Source.


@licend  The above is the entire license notice
for the JavaScript code in this tag.
*/
<!--/*--><![CDATA[/*><!--*/
 function CodeHighlightOn(elem, id)
 {
   var target = document.getElementById(id);
   if(null != target) {
     elem.cacheClassElem = elem.className;
     elem.cacheClassTarget = target.className;
     target.className = "code-highlighted";
     elem.className   = "code-highlighted";
   }
 }
 function CodeHighlightOff(elem, id)
 {
   var target = document.getElementById(id);
   if(elem.cacheClassElem)
     elem.className = elem.cacheClassElem;
   if(elem.cacheClassTarget)
     target.className = elem.cacheClassTarget;
 }
/*]]>*///-->
</script>
</head>
<body>
<div id="content">
<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#org4b16757">1. Javascript code for animation</a>
<ul>
<li><a href="#orga57f1e3">1.1. Basic controls</a></li>
<li><a href="#org73ca6e9">1.2. Utilities function to read cookies</a></li>
<li><a href="#org7a4aea2">1.3. Utility funciton to write a cookie</a></li>
<li><a href="#org5e30899">1.4. Global variables for animation control buttons</a></li>
<li><a href="#org44f35ba">1.5. Functions for each button in the button panel</a></li>
<li><a href="#orga25e0d8">1.6. Function to initialize a canvas</a></li>
<li><a href="#org8345f88">1.7. Holder for all animated objects.</a></li>
<li><a href="#org8af6e7c">1.8. Function to start a new animation.</a></li>
</ul>
</li>
<li><a href="#org875b66f">2. Tangle</a></li>
</ul>
</div>
</div>
<p>
*License
<i>/ Copyright 2011 David Galles, University of San Francisco. All rights reserved.
/</i>
<i>/ Redistribution and use in source and binary forms, with or without modification, are
/</i> permitted provided that the following conditions are met:
<i>/
/</i> 1. Redistributions of source code must retain the above copyright notice, this list of
<i>/ conditions and the following disclaimer.
/</i>
<i>/ 2. Redistributions in binary form must reproduce the above copyright notice, this list
/</i> of conditions and the following disclaimer in the documentation and/or other materials
<i>/ provided with the distribution.
/</i>
<i>/ THIS SOFTWARE IS PROVIDED BY &lt;COPYRIGHT HOLDER&gt; ``AS IS'' AND ANY EXPRESS OR IMPLIED
/</i> WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND
<i>/ FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL &lt;COPYRIGHT HOLDER&gt; OR
/</i> CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR
<i>/ CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR
/</i> SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON
<i>/ ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
/</i> NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF
<i>/ ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
/</i>
<i>/ The views and conclusions contained in the software and documentation are those of the
/</i> authors and should not be interpreted as representing official policies, either expressed
// or implied, of the University of San Francisco
</p>
<div id="outline-container-org4b16757" class="outline-2">
<h2 id="org4b16757"><span class="section-number-2">1</span> Javascript code for animation</h2>
<div class="outline-text-2" id="text-1">
</div>
<div id="outline-container-orga57f1e3" class="outline-3">
<h3 id="orga57f1e3"><span class="section-number-3">1.1</span> Basic controls</h3>
<div class="outline-text-3" id="text-1-1">
<div class="org-src-container">
<pre class="src src-js" id="org603a3ca">
<span style="font-weight: bold;">var</span> <span style="font-weight: bold; font-style: italic;">timer</span>;
<span style="font-weight: bold;">var</span> <span style="font-weight: bold; font-style: italic;">swapped</span> = <span style="font-weight: bold; text-decoration: underline;">false</span>;


<span style="font-weight: bold;">function</span> <span style="font-weight: bold;">reorderSibling</span>(<span style="font-weight: bold; font-style: italic;">node1</span>, <span style="font-weight: bold; font-style: italic;">node2</span>) 
{
    node1.parentNode.replaceChild(node1, node2);
    node1.parentNode.insertBefore(node2, node1); 
}


<span style="font-weight: bold;">function</span> <span style="font-weight: bold;">swapControlDiv</span>()
{
    swapped = !swapped;
    <span style="font-weight: bold;">if</span> (swapped) {
        reorderSibling(document.getElementById(<span style="font-style: italic;">'canvas'</span>), document.getElementById(<span style="font-style: italic;">'generalAnimationControlSection'</span>));
        setCookie(<span style="font-style: italic;">"VisualizationControlSwapped"</span>, <span style="font-style: italic;">"true"</span>, 30);

    } <span style="font-weight: bold;">else</span> {
        reorderSibling(document.getElementById(<span style="font-style: italic;">'generalAnimationControlSection'</span>), document.getElementById(<span style="font-style: italic;">'canvas'</span>));
        setCookie(<span style="font-style: italic;">"VisualizationControlSwapped"</span>, <span style="font-style: italic;">"false"</span>, 30);

    }
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org73ca6e9" class="outline-3">
<h3 id="org73ca6e9"><span class="section-number-3">1.2</span> Utilities function to read cookies</h3>
<div class="outline-text-3" id="text-1-2">
<div class="org-src-container">
<pre class="src src-js" id="org679353d">
<span style="font-weight: bold;">function</span> <span style="font-weight: bold;">getCookie</span>(<span style="font-weight: bold; font-style: italic;">cookieName</span>)
{
        <span style="font-weight: bold;">var</span> <span style="font-weight: bold; font-style: italic;">i</span>, <span style="font-weight: bold; font-style: italic;">x</span>, <span style="font-weight: bold; font-style: italic;">y</span>;
        <span style="font-weight: bold;">var</span> <span style="font-weight: bold; font-style: italic;">cookies</span>=document.cookie.split(<span style="font-style: italic;">";"</span>);
        <span style="font-weight: bold;">for</span> (i=0; i &lt; cookies.length; i++)
        {
                x=cookies[i].substr(0,cookies[i].indexOf(<span style="font-style: italic;">"="</span>));
                y=cookies[i].substr(cookies[i].indexOf(<span style="font-style: italic;">"="</span>)+1);
                x=x.replace(<span style="font-style: italic;">/^\s+|\s+$/</span>g,<span style="font-style: italic;">""</span>);
                <span style="font-weight: bold;">if</span> (x==cookieName)
                {
                        <span style="font-weight: bold;">return</span> unescape(y);
                }
        }
}
</pre>
</div>
</div>
</div>
<div id="outline-container-org7a4aea2" class="outline-3">
<h3 id="org7a4aea2"><span class="section-number-3">1.3</span> Utility funciton to write a cookie</h3>
<div class="outline-text-3" id="text-1-3">
<div class="org-src-container">
<pre class="src src-js" id="org6e1ca96">
<span style="font-weight: bold;">function</span> <span style="font-weight: bold;">setCookie</span>(<span style="font-weight: bold; font-style: italic;">cookieName</span>,<span style="font-weight: bold; font-style: italic;">value</span>,<span style="font-weight: bold; font-style: italic;">expireDays</span>)
{
        <span style="font-weight: bold;">var</span> <span style="font-weight: bold; font-style: italic;">exdate</span>=<span style="font-weight: bold;">new</span> <span style="font-weight: bold; text-decoration: underline;">Date</span>();
        exdate.setDate(exdate.getDate() + expireDays);
        <span style="font-weight: bold;">var</span> <span style="font-weight: bold; font-style: italic;">cookieValue</span>=escape(value) + ((expireDays==<span style="font-weight: bold; text-decoration: underline;">null</span>) ? <span style="font-style: italic;">""</span> : <span style="font-style: italic;">"; expires="</span>+exdate.toUTCString());
        document.cookie=cookieName + <span style="font-style: italic;">"="</span> + value;
}

</pre>
</div>
</div>
</div>

<div id="outline-container-org5e30899" class="outline-3">
<h3 id="org5e30899"><span class="section-number-3">1.4</span> Global variables for animation control buttons</h3>
<div class="outline-text-3" id="text-1-4">
<div class="org-src-container">
<pre class="src src-js" id="org6395422">

<span style="font-weight: bold;">var</span> <span style="font-weight: bold; font-style: italic;">ANIMATION_SPEED_DEFAULT</span> = 75;


<span style="font-weight: bold; font-style: italic;">// </span><span style="font-weight: bold; font-style: italic;">TODO:  Move these out of global space into animation manager?</span>
<span style="font-weight: bold;">var</span> <span style="font-weight: bold; font-style: italic;">objectManager</span>;
<span style="font-weight: bold;">var</span> <span style="font-weight: bold; font-style: italic;">animationManager</span>;
<span style="font-weight: bold;">var</span> <span style="font-weight: bold; font-style: italic;">canvas</span>;

<span style="font-weight: bold;">var</span> <span style="font-weight: bold; font-style: italic;">paused</span> = <span style="font-weight: bold; text-decoration: underline;">false</span>;
<span style="font-weight: bold;">var</span> <span style="font-weight: bold; font-style: italic;">playPauseBackButton</span>;
<span style="font-weight: bold;">var</span> <span style="font-weight: bold; font-style: italic;">skipBackButton</span>;
<span style="font-weight: bold;">var</span> <span style="font-weight: bold; font-style: italic;">stepBackButton</span>;
<span style="font-weight: bold;">var</span> <span style="font-weight: bold; font-style: italic;">stepForwardButton</span>;
<span style="font-weight: bold;">var</span> <span style="font-weight: bold; font-style: italic;">skipForwardButton</span>;

<span style="font-weight: bold;">var</span> <span style="font-weight: bold; font-style: italic;">widthEntry</span>;
<span style="font-weight: bold;">var</span> <span style="font-weight: bold; font-style: italic;">heightEntry</span>;
<span style="font-weight: bold;">var</span> <span style="font-weight: bold; font-style: italic;">sizeButton</span>;

</pre>
</div>
</div>
</div>
<div id="outline-container-org44f35ba" class="outline-3">
<h3 id="org44f35ba"><span class="section-number-3">1.5</span> Functions for each button in the button panel</h3>
<div class="outline-text-3" id="text-1-5">
<div class="org-src-container">
<pre class="src src-js" id="org315230a">
<span style="font-weight: bold;">function</span> <span style="font-weight: bold;">returnSubmit</span>(<span style="font-weight: bold; font-style: italic;">field</span>, <span style="font-weight: bold; font-style: italic;">funct</span>, <span style="font-weight: bold; font-style: italic;">maxsize</span>, <span style="font-weight: bold; font-style: italic;">intOnly</span>)
{
    
        <span style="font-weight: bold;">if</span> (maxsize != <span style="font-weight: bold; text-decoration: underline;">undefined</span>)
        {
                field.size = maxsize;
        }
        <span style="font-weight: bold;">return</span> <span style="font-weight: bold;">function</span>(<span style="font-weight: bold; font-style: italic;">event</span>)
        {       
                <span style="font-weight: bold;">var</span> <span style="font-weight: bold; font-style: italic;">keyASCII</span> = 0;
                <span style="font-weight: bold;">if</span>(window.event) <span style="font-weight: bold; font-style: italic;">// </span><span style="font-weight: bold; font-style: italic;">IE</span>
                {
                        keyASCII = event.keyCode
                }
                <span style="font-weight: bold;">else</span> <span style="font-weight: bold;">if</span> (event.which) <span style="font-weight: bold; font-style: italic;">// </span><span style="font-weight: bold; font-style: italic;">Netscape/Firefox/Opera</span>
                {
                        keyASCII = event.which
                } 

                <span style="font-weight: bold;">if</span> (keyASCII == 13)
                {
                        funct();
                        <span style="font-weight: bold;">return</span> <span style="font-weight: bold; text-decoration: underline;">false</span>;
                }
                <span style="font-weight: bold;">else</span> <span style="font-weight: bold;">if</span> (keyASCII == 59  || keyASCII == 45 || keyASCII == 46 || keyASCII == 190 || keyASCII == 173)
                {
                       <span style="font-weight: bold;">return</span> <span style="font-weight: bold; text-decoration: underline;">false</span>;    
                } 
                <span style="font-weight: bold;">else</span> <span style="font-weight: bold;">if</span> (maxsize != <span style="font-weight: bold; text-decoration: underline;">undefined</span> &amp;&amp; field.value.length &gt;= maxsize ||
                                 intOnly &amp;&amp; (keyASCII &lt; 48 || keyASCII &gt; 57))

                {
                        <span style="font-weight: bold;">if</span> (!controlKey(keyASCII))
                                <span style="font-weight: bold;">return</span> <span style="font-weight: bold; text-decoration: underline;">false</span>;
                }
            <span style="font-weight: bold;">return</span> <span style="font-weight: bold; text-decoration: underline;">true</span>;
                
        }
        
}


<span style="font-weight: bold;">function</span> <span style="font-weight: bold;">animWaiting</span>()
{
        stepForwardButton.disabled = <span style="font-weight: bold; text-decoration: underline;">false</span>;
        <span style="font-weight: bold;">if</span> (skipBackButton.disabled == <span style="font-weight: bold; text-decoration: underline;">false</span>)
        {
                stepBackButton.disabled = <span style="font-weight: bold; text-decoration: underline;">false</span>;
        }
        <span style="font-weight: bold; font-style: italic;">// </span><span style="font-weight: bold; font-style: italic;">objectManager.statusReport.setText("Animation Paused");</span>
        objectManager.statusReport.setForegroundColor(<span style="font-style: italic;">"#FF0000"</span>);
}

<span style="font-weight: bold;">function</span> <span style="font-weight: bold;">animStarted</span>()
{
        skipForwardButton.disabled = <span style="font-weight: bold; text-decoration: underline;">false</span>;
        skipBackButton.disabled = <span style="font-weight: bold; text-decoration: underline;">false</span>;
        stepForwardButton.disabled = <span style="font-weight: bold; text-decoration: underline;">true</span>;
        stepBackButton.disabled = <span style="font-weight: bold; text-decoration: underline;">true</span>;
        <span style="font-weight: bold; font-style: italic;">// </span><span style="font-weight: bold; font-style: italic;">objectManager.statusReport.setText("Animation Running");</span>
        objectManager.statusReport.setForegroundColor(<span style="font-style: italic;">"#009900"</span>);
}

<span style="font-weight: bold;">function</span> <span style="font-weight: bold;">animEnded</span>()
{
        skipForwardButton.disabled = <span style="font-weight: bold; text-decoration: underline;">true</span>;
        stepForwardButton.disabled = <span style="font-weight: bold; text-decoration: underline;">true</span>;
        <span style="font-weight: bold;">if</span> (skipBackButton.disabled == <span style="font-weight: bold; text-decoration: underline;">false</span> &amp;&amp; paused)
        {
                stepBackButton.disabled = <span style="font-weight: bold; text-decoration: underline;">false</span>;                
        }
        objectManager.statusReport.setText(<span style="font-style: italic;">""</span>);
        objectManager.statusReport.setForegroundColor(<span style="font-style: italic;">"#000000"</span>);
}



<span style="font-weight: bold;">function</span> <span style="font-weight: bold;">anumUndoUnavailable</span>()
{
        skipBackButton.disabled = <span style="font-weight: bold; text-decoration: underline;">true</span>;
        stepBackButton.disabled = <span style="font-weight: bold; text-decoration: underline;">true</span>;
}


<span style="font-weight: bold;">function</span> <span style="font-weight: bold;">timeout</span>()
{
        <span style="font-weight: bold; font-style: italic;">// </span><span style="font-weight: bold; font-style: italic;">We need to set the timeout *first*, otherwise if we</span>
        <span style="font-weight: bold; font-style: italic;">// </span><span style="font-weight: bold; font-style: italic;">try to clear it later, we get behavior we don't want ...</span>
    timer = setTimeout(<span style="font-style: italic;">'timeout()'</span>, 30); 
        animationManager.update();
        objectManager.draw();   
        
}


<span style="font-weight: bold;">function</span> <span style="font-weight: bold;">doStep</span>()
{
        animationManager.step();
}


<span style="font-weight: bold;">function</span> <span style="font-weight: bold;">doSkip</span>()
{
        animationManager.skipForward();
}


<span style="font-weight: bold;">function</span> <span style="font-weight: bold;">doSkipBack</span>()
{
        animationManager.skipBack();
}


<span style="font-weight: bold;">function</span> <span style="font-weight: bold;">doStepBack</span>()
{
        animationManager.stepBack();
}
<span style="font-weight: bold;">function</span> <span style="font-weight: bold;">doPlayPause</span>()
{
        paused = !paused;
        <span style="font-weight: bold;">if</span> (paused)
        {
                playPauseBackButton.setAttribute(<span style="font-style: italic;">"value"</span>, <span style="font-style: italic;">"play"</span>);
                <span style="font-weight: bold;">if</span> (skipBackButton.disabled == <span style="font-weight: bold; text-decoration: underline;">false</span>)
                {
                        stepBackButton.disabled = <span style="font-weight: bold; text-decoration: underline;">false</span>;                
                }
                
        }
        <span style="font-weight: bold;">else</span>
        {
                playPauseBackButton.setAttribute(<span style="font-style: italic;">"value"</span>, <span style="font-style: italic;">"pause"</span>);     
        }
        animationManager.SetPaused(paused);
}


<span style="font-weight: bold;">function</span> <span style="font-weight: bold;">addControl</span>(<span style="font-weight: bold; font-style: italic;">type</span>, <span style="font-weight: bold; font-style: italic;">name</span>, <span style="font-weight: bold; font-style: italic;">location</span>) {
        
    <span style="font-weight: bold;">var</span> <span style="font-weight: bold; font-style: italic;">element</span> = document.createElement(<span style="font-style: italic;">"input"</span>);
        
    element.setAttribute(<span style="font-style: italic;">"type"</span>, type);
    element.setAttribute(<span style="font-style: italic;">"value"</span>, name);

        <span style="font-weight: bold;">var</span> <span style="font-weight: bold; font-style: italic;">tableEntry</span> = document.createElement(<span style="font-style: italic;">"td"</span>);
        
        tableEntry.appendChild(element);
        
        
    <span style="font-weight: bold;">var</span> <span style="font-weight: bold; font-style: italic;">controlBar</span> = document.getElementById(tableEntry);
        
    <span style="font-weight: bold; font-style: italic;">//</span><span style="font-weight: bold; font-style: italic;">Append the element in page (in span).</span>
    controlBar.appendChild(element);
        <span style="font-weight: bold;">return</span> element;
 
}

<span style="font-weight: bold;">function</span> <span style="font-weight: bold;">addControlToAnimationBar</span>(<span style="font-weight: bold; font-style: italic;">type</span>,<span style="font-weight: bold; font-style: italic;">name</span>,<span style="font-weight: bold; font-style: italic;">containerType</span>)
{
        <span style="font-weight: bold;">if</span> (containerType == <span style="font-weight: bold; text-decoration: underline;">undefined</span>)
        {
                        containerType = <span style="font-style: italic;">"input"</span>;
        }
        <span style="font-weight: bold;">var</span> <span style="font-weight: bold; font-style: italic;">element</span> = document.createElement(containerType);
        
        element.setAttribute(<span style="font-style: italic;">"type"</span>, type);
        element.setAttribute(<span style="font-style: italic;">"value"</span>, name);


        <span style="font-weight: bold;">if</span>(type==<span style="font-style: italic;">"Button"</span>){
                element.style.backgroundColor = <span style="font-style: italic;">"#3297CF"</span>;
                element.style.borderColor = <span style="font-style: italic;">"#3297CF"</span>;
                element.style.color=<span style="font-style: italic;">"#ffffff"</span>
                element.style.borderStyle = <span style="font-style: italic;">"solid"</span>
                element.style.fontSize = <span style="font-style: italic;">"16px"</span>;
                element.style.width = <span style="font-style: italic;">"100%"</span>;
                element.style.height = <span style="font-style: italic;">"100%"</span>;
                element.style.borderRadius = <span style="font-style: italic;">"100px"</span>

        }
        

        
        
        <span style="font-weight: bold;">var</span> <span style="font-weight: bold; font-style: italic;">tableEntry</span> = document.createElement(<span style="font-style: italic;">"td"</span>);
        tableEntry.style.width=<span style="font-style: italic;">"10%"</span>;
        
        
        tableEntry.appendChild(element);
        
    <span style="font-weight: bold;">var</span> <span style="font-weight: bold; font-style: italic;">controlBar</span> = document.getElementById(<span style="font-style: italic;">"GeneralAnimationControls"</span>);
        
    <span style="font-weight: bold; font-style: italic;">//</span><span style="font-weight: bold; font-style: italic;">Append the element in page (in span).</span>
    controlBar.appendChild(tableEntry);
        <span style="font-weight: bold;">return</span> element;
        
}

</pre>
</div>
</div>
</div>

<div id="outline-container-orga25e0d8" class="outline-3">
<h3 id="orga25e0d8"><span class="section-number-3">1.6</span> Function to initialize a canvas</h3>
<div class="outline-text-3" id="text-1-6">
<div class="org-src-container">
<pre class="src src-js" id="org708181c">

<span style="font-weight: bold;">function</span> <span style="font-weight: bold;">initCanvas</span>()
{
        canvas =  document.getElementById(<span style="font-style: italic;">"canvas"</span>);
        objectManager = <span style="font-weight: bold;">new</span> <span style="font-weight: bold; text-decoration: underline;">ObjectManager</span>();
        animationManager = <span style="font-weight: bold;">new</span> <span style="font-weight: bold; text-decoration: underline;">AnimationManager</span>(objectManager);
        
        skipBackButton = addControlToAnimationBar(<span style="font-style: italic;">"Button"</span>, <span style="font-style: italic;">"Skip Back"</span>);
        skipBackButton.onclick = animationManager.skipBack.bind(animationManager);
        stepBackButton = addControlToAnimationBar(<span style="font-style: italic;">"Button"</span>, <span style="font-style: italic;">"Step Back"</span>);
        stepBackButton.onclick = animationManager.stepBack.bind(animationManager);
        playPauseBackButton = addControlToAnimationBar(<span style="font-style: italic;">"Button"</span>, <span style="font-style: italic;">"Pause"</span>);
        playPauseBackButton.onclick = doPlayPause ;
        stepForwardButton = addControlToAnimationBar(<span style="font-style: italic;">"Button"</span>, <span style="font-style: italic;">"Step Forward"</span>);
        stepForwardButton.onclick = animationManager.step.bind(animationManager) ;
        skipForwardButton = addControlToAnimationBar(<span style="font-style: italic;">"Button"</span>, <span style="font-style: italic;">"Skip Forward"</span>);
        skipForwardButton.onclick = animationManager.skipForward.bind(animationManager);
        
        
        <span style="font-weight: bold;">var</span> <span style="font-weight: bold; font-style: italic;">element</span> = document.createElement(<span style="font-style: italic;">"div"</span>);
        element.setAttribute(<span style="font-style: italic;">"display"</span>, <span style="font-style: italic;">"inline-block"</span>);                
        element.setAttribute(<span style="font-style: italic;">"float"</span>, <span style="font-style: italic;">"left"</span>);          

        
        <span style="font-weight: bold;">var</span> <span style="font-weight: bold; font-style: italic;">tableEntry</span> = document.createElement(<span style="font-style: italic;">"td"</span>);
        
        
    <span style="font-weight: bold;">var</span> <span style="font-weight: bold; font-style: italic;">controlBar</span> = document.getElementById(<span style="font-style: italic;">"GeneralAnimationControls"</span>);
        
        
        
        <span style="font-weight: bold;">var</span> <span style="font-weight: bold; font-style: italic;">newTable</span> = document.createElement(<span style="font-style: italic;">"table"</span>);

        <span style="font-weight: bold;">var</span> <span style="font-weight: bold; font-style: italic;">midLevel</span> = document.createElement(<span style="font-style: italic;">"tr"</span>);
        <span style="font-weight: bold;">var</span> <span style="font-weight: bold; font-style: italic;">bottomLevel</span> = document.createElement(<span style="font-style: italic;">"td"</span>);
        midLevel.appendChild(bottomLevel);
        bottomLevel.appendChild(element);
        newTable.appendChild(midLevel); 
        
        
        
        midLevel = document.createElement(<span style="font-style: italic;">"tr"</span>);
        bottomLevel = document.createElement(<span style="font-style: italic;">"td"</span>);
        bottomLevel.align = <span style="font-style: italic;">"center"</span>;
        <span style="font-weight: bold;">var</span> <span style="font-weight: bold; font-style: italic;">txtNode</span> = document.createTextNode(<span style="font-style: italic;">"Animation Speed"</span>); 
        midLevel.appendChild(bottomLevel);
        bottomLevel.appendChild(txtNode);
        newTable.appendChild(midLevel); 

        
        
        tableEntry.appendChild(newTable);
        
        
        
    <span style="font-weight: bold; font-style: italic;">//</span><span style="font-weight: bold; font-style: italic;">Append the element in page (in span).</span>
    controlBar.appendChild(tableEntry);
                
    <span style="font-weight: bold; font-style: italic;">//</span><span style="font-weight: bold; font-style: italic;">tableEntry.appendChild(element);</span>

        <span style="font-weight: bold;">var</span> <span style="font-weight: bold; font-style: italic;">speed</span> = getCookie(<span style="font-style: italic;">"VisualizationSpeed"</span>);
        <span style="font-weight: bold;">if</span> (speed == <span style="font-weight: bold; text-decoration: underline;">null</span> || speed == <span style="font-style: italic;">""</span>)
        {
                speed = ANIMATION_SPEED_DEFAULT;
        }
        <span style="font-weight: bold;">else</span>
        {
                speed = parseInt(speed);
        }
        
        $(element).slider({
                                          animate: <span style="font-weight: bold; text-decoration: underline;">true</span>,
                                          value: speed,
                                          <span style="font-weight: bold;">change</span>: <span style="font-weight: bold;">function</span>(<span style="font-weight: bold; font-style: italic;">e</span>, <span style="font-weight: bold; font-style: italic;">ui</span>)
                                          {
                                                setCookie(<span style="font-style: italic;">"VisualizationSpeed"</span>, String(ui.value), 30);
                                          },
                                          <span style="font-weight: bold;">slide</span> : <span style="font-weight: bold;">function</span>(<span style="font-weight: bold; font-style: italic;">e</span>, <span style="font-weight: bold; font-style: italic;">ui</span>){
                                          animationManager.SetSpeed(ui.value); 
                                          }

                                          }); 
        
        animationManager.SetSpeed(speed);
        
        element.setAttribute(<span style="font-style: italic;">"style"</span>, <span style="font-style: italic;">"width:200px"</span>);



        <span style="font-weight: bold;">var</span> <span style="font-weight: bold; font-style: italic;">width</span>=getCookie(<span style="font-style: italic;">"VisualizationWidth"</span>);
        <span style="font-weight: bold;">if</span> (width == <span style="font-weight: bold; text-decoration: underline;">null</span> || width == <span style="font-style: italic;">""</span>)
        {
                width = canvas.width;
        }
        <span style="font-weight: bold;">else</span>
        {
                width = parseInt(width);
        }
        <span style="font-weight: bold;">var</span> <span style="font-weight: bold; font-style: italic;">height</span>=getCookie(<span style="font-style: italic;">"VisualizationHeight"</span>);
        <span style="font-weight: bold;">if</span> (height == <span style="font-weight: bold; text-decoration: underline;">null</span> || height == <span style="font-style: italic;">""</span>)
        {
                height = canvas.height;
        }
        <span style="font-weight: bold;">else</span>
        {
                height = parseInt(height);
        }

        <span style="font-weight: bold;">var</span> <span style="font-weight: bold; font-style: italic;">swappedControls</span>=getCookie(<span style="font-style: italic;">"VisualizationControlSwapped"</span>);
        swapped = swappedControls == <span style="font-style: italic;">"true"</span>
        <span style="font-weight: bold;">if</span> (swapped)
        {
            reorderSibling(document.getElementById(<span style="font-style: italic;">'canvas'</span>), document.getElementById(<span style="font-style: italic;">'generalAnimationControlSection'</span>));
        }

        canvas.width = width;
        canvas.height = height;
        
        
        
        
        animationManager.addListener(<span style="font-style: italic;">"AnimationStarted"</span>, <span style="font-weight: bold; text-decoration: underline;">this</span>, animStarted);
        animationManager.addListener(<span style="font-style: italic;">"AnimationEnded"</span>, <span style="font-weight: bold; text-decoration: underline;">this</span>, <span style="font-weight: bold; text-decoration: underline;">this</span>.animEnded);
        animationManager.addListener(<span style="font-style: italic;">"AnimationWaiting"</span>, <span style="font-weight: bold; text-decoration: underline;">this</span>, <span style="font-weight: bold; text-decoration: underline;">this</span>.animWaiting);
        animationManager.addListener(<span style="font-style: italic;">"AnimationUndoUnavailable"</span>, <span style="font-weight: bold; text-decoration: underline;">this</span>, <span style="font-weight: bold; text-decoration: underline;">this</span>.anumUndoUnavailable);
        objectManager.width = canvas.width;
        objectManager.height = canvas.height;
        <span style="font-weight: bold;">return</span> animationManager;
}

</pre>
</div>
</div>
</div>

<div id="outline-container-org8345f88" class="outline-3">
<h3 id="org8345f88"><span class="section-number-3">1.7</span> Holder for all animated objects.</h3>
<div class="outline-text-3" id="text-1-7">
<p>
All animation is done by manipulating objects in this container
</p>

<div class="org-src-container">
<pre class="src src-js" id="org7479602">
<span style="font-weight: bold;">function</span> <span style="font-weight: bold;">AnimationManager</span>(<span style="font-weight: bold; font-style: italic;">objectManager</span>)
{
        <span style="font-weight: bold; font-style: italic;">// </span><span style="font-weight: bold; font-style: italic;">Holder for all animated objects.</span>
        <span style="font-weight: bold; font-style: italic;">// </span><span style="font-weight: bold; font-style: italic;">All animation is done by manipulating objects in\</span>
        <span style="font-weight: bold; font-style: italic;">// </span><span style="font-weight: bold; font-style: italic;">this container</span>
        <span style="font-weight: bold; text-decoration: underline;">this</span>.animatedObjects = objectManager;

        <span style="font-weight: bold; font-style: italic;">// </span><span style="font-weight: bold; font-style: italic;">Control variables for stopping / starting animation</span>
        
        <span style="font-weight: bold; text-decoration: underline;">this</span>.animationPaused = <span style="font-weight: bold; text-decoration: underline;">false</span>;
        <span style="font-weight: bold; text-decoration: underline;">this</span>.awaitingStep = <span style="font-weight: bold; text-decoration: underline;">false</span>;
        <span style="font-weight: bold; text-decoration: underline;">this</span>.currentlyAnimating = <span style="font-weight: bold; text-decoration: underline;">false</span>;
        
        <span style="font-weight: bold; font-style: italic;">// </span><span style="font-weight: bold; font-style: italic;">Array holding the code for the animation.  This is </span>
        <span style="font-weight: bold; font-style: italic;">// </span><span style="font-weight: bold; font-style: italic;">an array of strings, each of which is an animation command</span>
        <span style="font-weight: bold; font-style: italic;">// </span><span style="font-weight: bold; font-style: italic;">currentAnimation is an index into this array</span>
        <span style="font-weight: bold; text-decoration: underline;">this</span>.AnimationSteps = [];
        <span style="font-weight: bold; text-decoration: underline;">this</span>.currentAnimation = 0;
        
        <span style="font-weight: bold; text-decoration: underline;">this</span>.previousAnimationSteps = [];
        
        
        <span style="font-weight: bold; text-decoration: underline;">this</span>.currFrame = 0;
        <span style="font-weight: bold; text-decoration: underline;">this</span>.animationBlockLength = 0;
        
        <span style="font-weight: bold; font-style: italic;">//  </span><span style="font-weight: bold; font-style: italic;">The animation block that is currently running.  Array of singleAnimations</span>
        <span style="font-weight: bold; text-decoration: underline;">this</span>.currentBlock = <span style="font-weight: bold; text-decoration: underline;">null</span>;
        
        <span style="font-weight: bold; font-style: italic;">/////////////////////////////////////</span>
        <span style="font-weight: bold; font-style: italic;">// </span><span style="font-weight: bold; font-style: italic;">Variables for handling undo. </span>
        <span style="font-weight: bold; font-style: italic;">////////////////////////////////////</span>
        <span style="font-weight: bold; font-style: italic;">//  </span><span style="font-weight: bold; font-style: italic;">A stack of UndoBlock objects (subclassed, UndoBlock is an abstract base class)</span>
        <span style="font-weight: bold; font-style: italic;">//  </span><span style="font-weight: bold; font-style: italic;">each of which can undo a single animation element</span>
        <span style="font-weight: bold; text-decoration: underline;">this</span>.undoStack = [];
        <span style="font-weight: bold; text-decoration: underline;">this</span>.doingUndo = <span style="font-weight: bold; text-decoration: underline;">false</span>;
        
        <span style="font-weight: bold; font-style: italic;">// </span><span style="font-weight: bold; font-style: italic;">A stack containing the beginning of each animation block, as an index</span>
        <span style="font-weight: bold; font-style: italic;">// </span><span style="font-weight: bold; font-style: italic;">into the AnimationSteps array</span>
        <span style="font-weight: bold; text-decoration: underline;">this</span>.undoAnimationStepIndices = [];
        <span style="font-weight: bold; text-decoration: underline;">this</span>.undoAnimationStepIndicesStack = [];
        
        <span style="font-weight: bold; text-decoration: underline;">this</span>.animationBlockLength = 10;

        <span style="font-weight: bold; text-decoration: underline;">this</span>.lerp = <span style="font-weight: bold;">function</span>(<span style="font-weight: bold; font-style: italic;">from</span>, <span style="font-weight: bold; font-style: italic;">to</span>, <span style="font-weight: bold; font-style: italic;">percent</span>)
        {
                <span style="font-weight: bold;">return</span> (to - from) * percent + from;
        }
        
        <span style="font-weight: bold; font-style: italic;">// </span><span style="font-weight: bold; font-style: italic;">Pause / unpause animation</span>
        <span style="font-weight: bold; text-decoration: underline;">this</span>.SetPaused = <span style="font-weight: bold;">function</span>(<span style="font-weight: bold; font-style: italic;">pausedValue</span>)
        {
                <span style="font-weight: bold; text-decoration: underline;">this</span>.animationPaused = pausedValue;
                <span style="font-weight: bold;">if</span> (!<span style="font-weight: bold; text-decoration: underline;">this</span>.animationPaused)
                {
                        <span style="font-weight: bold; text-decoration: underline;">this</span>.step();
                }
        }
        
        <span style="font-weight: bold; font-style: italic;">// </span><span style="font-weight: bold; font-style: italic;">Set the speed of the animation, from 0 (slow) to 100 (fast)</span>
        <span style="font-weight: bold; text-decoration: underline;">this</span>.SetSpeed = <span style="font-weight: bold;">function</span>(<span style="font-weight: bold; font-style: italic;">newSpeed</span>)
        {
                <span style="font-weight: bold; text-decoration: underline;">this</span>.animationBlockLength = Math.floor((100-newSpeed) / 2);
        }
        

        <span style="font-weight: bold; text-decoration: underline;">this</span>.parseBool = <span style="font-weight: bold;">function</span>(<span style="font-weight: bold; font-style: italic;">str</span>)
        {
                <span style="font-weight: bold;">var</span> <span style="font-weight: bold; font-style: italic;">uppercase</span> = str.toUpperCase();
                <span style="font-weight: bold;">var</span> <span style="font-weight: bold; font-style: italic;">returnVal</span> =  !(uppercase == <span style="font-style: italic;">"False"</span> || uppercase == <span style="font-style: italic;">"f"</span> || uppercase == <span style="font-style: italic;">" 0"</span> || uppercase == <span style="font-style: italic;">"0"</span> || uppercase == <span style="font-style: italic;">""</span>);
                <span style="font-weight: bold;">return</span> returnVal;

        }

        <span style="font-weight: bold; text-decoration: underline;">this</span>.parseColor = <span style="font-weight: bold;">function</span>(<span style="font-weight: bold; font-style: italic;">clr</span>)
        {
                        <span style="font-weight: bold;">if</span> (clr.charAt(0) == <span style="font-style: italic;">"#"</span>)
                        {
                                <span style="font-weight: bold;">return</span> clr;
                        }
                        <span style="font-weight: bold;">else</span> <span style="font-weight: bold;">if</span> (clr.substring(0,2) == <span style="font-style: italic;">"0x"</span>)
                        {
                                <span style="font-weight: bold;">return</span> <span style="font-style: italic;">"#"</span> + clr.substring(2);
                        }
        }
        
        
        <span style="font-weight: bold; text-decoration: underline;">this</span>.changeSize = <span style="font-weight: bold;">function</span>()
        {
                
                <span style="font-weight: bold;">var</span> <span style="font-weight: bold; font-style: italic;">width</span> = parseInt(widthEntry.value);
                <span style="font-weight: bold;">var</span> <span style="font-weight: bold; font-style: italic;">height</span> = parseInt(heightEntry.value);
                
                <span style="font-weight: bold;">if</span> (width &gt; 100)
                {
                        canvas.width = width;
                        <span style="font-weight: bold; text-decoration: underline;">this</span>.animatedObjects.width = width;
                        setCookie(<span style="font-style: italic;">"VisualizationWidth"</span>, String(width), 30);
                        
                }
                <span style="font-weight: bold;">if</span> (height &gt; 100)
                {
                        canvas.height = height;
                        <span style="font-weight: bold; text-decoration: underline;">this</span>.animatedObjects.height = height;
                        setCookie(<span style="font-style: italic;">"VisualizationHeight"</span>, String(height), 30);
                }
                width.value = canvas.width;
                heightEntry.value = canvas.height;
                
                <span style="font-weight: bold; text-decoration: underline;">this</span>.animatedObjects.draw();
                <span style="font-weight: bold; text-decoration: underline;">this</span>.fireEvent(<span style="font-style: italic;">"CanvasSizeChanged"</span>,{width:canvas.width, height:canvas.height});         
        }
        
        <span style="font-weight: bold; text-decoration: underline;">this</span>.startNextBlock = <span style="font-weight: bold;">function</span>()
        {
                <span style="font-weight: bold; text-decoration: underline;">this</span>.awaitingStep = <span style="font-weight: bold; text-decoration: underline;">false</span>;
                <span style="font-weight: bold; text-decoration: underline;">this</span>.currentBlock = [];
                <span style="font-weight: bold;">var</span> <span style="font-weight: bold; font-style: italic;">undoBlock</span> = []
                <span style="font-weight: bold;">if</span> (<span style="font-weight: bold; text-decoration: underline;">this</span>.currentAnimation == <span style="font-weight: bold; text-decoration: underline;">this</span>.AnimationSteps.length )
                {
                        <span style="font-weight: bold; text-decoration: underline;">this</span>.currentlyAnimating = <span style="font-weight: bold; text-decoration: underline;">false</span>;
                        <span style="font-weight: bold; text-decoration: underline;">this</span>.awaitingStep = <span style="font-weight: bold; text-decoration: underline;">false</span>;
                        <span style="font-weight: bold; text-decoration: underline;">this</span>.fireEvent(<span style="font-style: italic;">"AnimationEnded"</span>,<span style="font-style: italic;">"NoData"</span>);
                        clearTimeout(timer);
                        <span style="font-weight: bold; text-decoration: underline;">this</span>.animatedObjects.update();
                        <span style="font-weight: bold; text-decoration: underline;">this</span>.animatedObjects.draw();
                        
                        <span style="font-weight: bold;">return</span>;
                }
                <span style="font-weight: bold; text-decoration: underline;">this</span>.undoAnimationStepIndices.push(<span style="font-weight: bold; text-decoration: underline;">this</span>.currentAnimation);

                <span style="font-weight: bold;">var</span> <span style="font-weight: bold; font-style: italic;">foundBreak</span>= <span style="font-weight: bold; text-decoration: underline;">false</span>;
                <span style="font-weight: bold;">var</span> <span style="font-weight: bold; font-style: italic;">anyAnimations</span>= <span style="font-weight: bold; text-decoration: underline;">false</span>;
                
                <span style="font-weight: bold;">while</span> (<span style="font-weight: bold; text-decoration: underline;">this</span>.currentAnimation &lt; <span style="font-weight: bold; text-decoration: underline;">this</span>.AnimationSteps.length &amp;&amp; !foundBreak)
                {                       
                        <span style="font-weight: bold;">var</span> <span style="font-weight: bold; font-style: italic;">nextCommand</span> = <span style="font-weight: bold; text-decoration: underline;">this</span>.AnimationSteps[<span style="font-weight: bold; text-decoration: underline;">this</span>.currentAnimation].split(<span style="font-style: italic;">"&lt;;&gt;"</span>);
                        <span style="font-weight: bold;">if</span> (nextCommand[0].toUpperCase() == <span style="font-style: italic;">"CREATECIRCLE"</span>)
                        {
                                <span style="font-weight: bold; text-decoration: underline;">this</span>.animatedObjects.addCircleObject(parseInt(nextCommand[1]), nextCommand[2]);
                                <span style="font-weight: bold;">if</span> (nextCommand.length &gt; 4)
                                {
                                        <span style="font-weight: bold; text-decoration: underline;">this</span>.animatedObjects.setNodePosition(parseInt(nextCommand[1]), parseInt(nextCommand[3]), parseInt(nextCommand[4]));
                                }
                                undoBlock.push(<span style="font-weight: bold;">new</span> <span style="font-weight: bold; text-decoration: underline;">UndoCreate</span>(parseInt(nextCommand[1])));

                        }
                        <span style="font-weight: bold;">else</span> <span style="font-weight: bold;">if</span> (nextCommand[0].toUpperCase() == <span style="font-style: italic;">"CONNECT"</span>)
                        {
                                
                                <span style="font-weight: bold;">if</span> (nextCommand.length &gt; 7)
                                {
                                        <span style="font-weight: bold; text-decoration: underline;">this</span>.animatedObjects.connectEdge(parseInt(nextCommand[1]), 
                                                                         parseInt(nextCommand[2]), 
                                                                         <span style="font-weight: bold; text-decoration: underline;">this</span>.parseColor(nextCommand[3]), 
                                                                         parseFloat(nextCommand[4]), 
                                                                         <span style="font-weight: bold; text-decoration: underline;">this</span>.parseBool(nextCommand[5]), 
                                                                         nextCommand[6], 
                                                                         parseInt(nextCommand[7]));
                                }
                                <span style="font-weight: bold;">else</span> <span style="font-weight: bold;">if</span> (nextCommand.length &gt; 6)
                                {
                                        <span style="font-weight: bold; text-decoration: underline;">this</span>.animatedObjects.connectEdge(parseInt(nextCommand[1]), 
                                                                         parseInt(nextCommand[2]),
                                                                         <span style="font-weight: bold; text-decoration: underline;">this</span>.parseColor(nextCommand[3]),
                                                                         parseFloat(nextCommand[4]),
                                                                         <span style="font-weight: bold; text-decoration: underline;">this</span>.parseBool(nextCommand[5]),
                                                                         nextCommand[6],
                                                                         0);
                                }
                                <span style="font-weight: bold;">else</span> <span style="font-weight: bold;">if</span> (nextCommand.length &gt; 5)
                                {
                                        <span style="font-weight: bold; text-decoration: underline;">this</span>.animatedObjects.connectEdge(parseInt(nextCommand[1]), 
                                                                         parseInt(nextCommand[2]),
                                                                         <span style="font-weight: bold; text-decoration: underline;">this</span>.parseColor(nextCommand[3]),
                                                                         parseFloat(nextCommand[4]),
                                                                         <span style="font-weight: bold; text-decoration: underline;">this</span>.parseBool(nextCommand[5]),
                                                                         <span style="font-style: italic;">""</span>,
                                                                         0);
                                }
                                <span style="font-weight: bold;">else</span> <span style="font-weight: bold;">if</span> (nextCommand.length &gt; 4)
                                {
                                        <span style="font-weight: bold; text-decoration: underline;">this</span>.animatedObjects.connectEdge(parseInt(nextCommand[1]),
                                                                         parseInt(nextCommand[2]),
                                                                         <span style="font-weight: bold; text-decoration: underline;">this</span>.parseColor(nextCommand[3]),
                                                                         parseFloat(nextCommand[4]),
                                                                         <span style="font-weight: bold; text-decoration: underline;">true</span>,
                                                                         <span style="font-style: italic;">""</span>,
                                                                         0);
                                }
                                <span style="font-weight: bold;">else</span> <span style="font-weight: bold;">if</span> (nextCommand.length &gt; 3)
                                {
                                        <span style="font-weight: bold; text-decoration: underline;">this</span>.animatedObjects.connectEdge(parseInt(nextCommand[1]),
                                                                         parseInt(nextCommand[2]),
                                                                                                                                                 <span style="font-weight: bold; text-decoration: underline;">this</span>.parseColor(nextCommand[3]),
                                                                         0.0,
                                                                         <span style="font-weight: bold; text-decoration: underline;">true</span>,
                                                                         <span style="font-style: italic;">""</span>,
                                                                         0);
                                }
                                <span style="font-weight: bold;">else</span>
                                {
                                        <span style="font-weight: bold; text-decoration: underline;">this</span>.animatedObjects.connectEdge(parseInt(nextCommand[1]),
                                                                         parseInt(nextCommand[2]),
                                                                                                                            <span style="font-style: italic;">"#000000"</span>,
                                                                         0.0,
                                                                         <span style="font-weight: bold; text-decoration: underline;">true</span>,
                                                                         <span style="font-style: italic;">""</span>,
                                                                         0);
                                        
                                }
                                undoBlock.push(<span style="font-weight: bold;">new</span> <span style="font-weight: bold; text-decoration: underline;">UndoConnect</span>(parseInt(nextCommand[1]), parseInt (nextCommand[2]), <span style="font-weight: bold; text-decoration: underline;">false</span>));
                        }
                        <span style="font-weight: bold;">else</span> <span style="font-weight: bold;">if</span> (nextCommand[0].toUpperCase() == <span style="font-style: italic;">"CREATERECTANGLE"</span>)
                        {
                                <span style="font-weight: bold;">if</span> (nextCommand.length == 9)
                                {
                                        <span style="font-weight: bold; text-decoration: underline;">this</span>.animatedObjects.addRectangleObject(parseInt(nextCommand[1]), <span style="font-weight: bold; font-style: italic;">// </span><span style="font-weight: bold; font-style: italic;">ID</span>
                                                                                                                        nextCommand[2], <span style="font-weight: bold; font-style: italic;">// </span><span style="font-weight: bold; font-style: italic;">Label</span>
                                                                                                                        parseInt(nextCommand[3]), <span style="font-weight: bold; font-style: italic;">// </span><span style="font-weight: bold; font-style: italic;">w</span>
                                                                                                                        parseInt(nextCommand[4]), <span style="font-weight: bold; font-style: italic;">// </span><span style="font-weight: bold; font-style: italic;">h</span>
                                                                                                                        nextCommand[7], <span style="font-weight: bold; font-style: italic;">// </span><span style="font-weight: bold; font-style: italic;">xJustify</span>
                                                                                                                        nextCommand[8],<span style="font-weight: bold; font-style: italic;">// </span><span style="font-weight: bold; font-style: italic;">yJustify</span>
                                                                                                                        <span style="font-style: italic;">"#ffffff"</span>, <span style="font-weight: bold; font-style: italic;">// </span><span style="font-weight: bold; font-style: italic;">background color</span>
                                                                                <span style="font-style: italic;">"#000000"</span>); <span style="font-weight: bold; font-style: italic;">// </span><span style="font-weight: bold; font-style: italic;">foreground color</span>
                                }
                                <span style="font-weight: bold;">else</span>
                                {
                                        <span style="font-weight: bold; text-decoration: underline;">this</span>.animatedObjects.addRectangleObject(parseInt(nextCommand[1]), <span style="font-weight: bold; font-style: italic;">// </span><span style="font-weight: bold; font-style: italic;">ID</span>
                                                                                                                        nextCommand[2], <span style="font-weight: bold; font-style: italic;">// </span><span style="font-weight: bold; font-style: italic;">Label</span>
                                                                                                                        parseInt(nextCommand[3]), <span style="font-weight: bold; font-style: italic;">// </span><span style="font-weight: bold; font-style: italic;">w</span>
                                                                                                                        parseInt(nextCommand[4]), <span style="font-weight: bold; font-style: italic;">// </span><span style="font-weight: bold; font-style: italic;">h</span>
                                                                                                                        <span style="font-style: italic;">"center"</span>, <span style="font-weight: bold; font-style: italic;">// </span><span style="font-weight: bold; font-style: italic;">xJustify</span>
                                                                                                                        <span style="font-style: italic;">"center"</span>,<span style="font-weight: bold; font-style: italic;">// </span><span style="font-weight: bold; font-style: italic;">yJustify</span>
                                                                                                                        <span style="font-style: italic;">"#ffffff"</span>, <span style="font-weight: bold; font-style: italic;">// </span><span style="font-weight: bold; font-style: italic;">background color</span>
                                                                                <span style="font-style: italic;">"#000000"</span>); <span style="font-weight: bold; font-style: italic;">// </span><span style="font-weight: bold; font-style: italic;">foreground color</span>
                                        
                                }
                                <span style="font-weight: bold;">if</span> (nextCommand.length &gt; 6)
                                {
                                        <span style="font-weight: bold; text-decoration: underline;">this</span>.animatedObjects.setNodePosition(parseInt(nextCommand[1]), parseInt(nextCommand[5]), parseInt(nextCommand[6]));
                                }
                                undoBlock.push(<span style="font-weight: bold;">new</span> <span style="font-weight: bold; text-decoration: underline;">UndoCreate</span>(parseInt(nextCommand[1])));
                        }
                        
                        <span style="font-weight: bold;">else</span> <span style="font-weight: bold;">if</span> (nextCommand[0].toUpperCase() == <span style="font-style: italic;">"MOVE"</span>)
                        {
                                <span style="font-weight: bold;">var</span> <span style="font-weight: bold; font-style: italic;">objectID</span> = parseInt(nextCommand[1]);
                                <span style="font-weight: bold;">var</span> <span style="font-weight: bold; font-style: italic;">nextAnim</span> =  <span style="font-weight: bold;">new</span> <span style="font-weight: bold; text-decoration: underline;">SingleAnimation</span>(objectID, 
                                                                                                        <span style="font-weight: bold; text-decoration: underline;">this</span>.animatedObjects.getNodeX(objectID), 
                                                                                                        <span style="font-weight: bold; text-decoration: underline;">this</span>.animatedObjects.getNodeY(objectID), 
                                                                                                        parseInt(nextCommand[2]),
                                                                                                        parseInt(nextCommand[3]));
                                <span style="font-weight: bold; text-decoration: underline;">this</span>.currentBlock.push(nextAnim);

                                undoBlock.push(<span style="font-weight: bold;">new</span> <span style="font-weight: bold; text-decoration: underline;">UndoMove</span>(nextAnim.objectID, nextAnim.toX, nextAnim.toY, nextAnim.fromX, nextAnim.fromY));

                                anyAnimations = <span style="font-weight: bold; text-decoration: underline;">true</span>;
                        }
                        
                        <span style="font-weight: bold;">else</span> <span style="font-weight: bold;">if</span> (nextCommand[0].toUpperCase() == <span style="font-style: italic;">"MOVETOALIGNRIGHT"</span>)
                        {
                                <span style="font-weight: bold;">var</span> <span style="font-weight: bold; font-style: italic;">id</span> = parseInt(nextCommand[1]);
                                <span style="font-weight: bold;">var</span> <span style="font-weight: bold; font-style: italic;">otherId</span> = parseInt(nextCommand[2]);
                                <span style="font-weight: bold;">var</span> <span style="font-weight: bold; font-style: italic;">newXY</span> = <span style="font-weight: bold; text-decoration: underline;">this</span>.animatedObjects.getAlignRightPos(id, otherId);


                                <span style="font-weight: bold;">var</span> <span style="font-weight: bold; font-style: italic;">nextAnim</span> =  <span style="font-weight: bold;">new</span> <span style="font-weight: bold; text-decoration: underline;">SingleAnimation</span>(id,
                                                                    <span style="font-weight: bold; text-decoration: underline;">this</span>.animatedObjects.getNodeX(id), 
                                                                    <span style="font-weight: bold; text-decoration: underline;">this</span>.animatedObjects.getNodeY(id), 
                                                                    newXY[0],
                                                                    newXY[1]);
                                <span style="font-weight: bold; text-decoration: underline;">this</span>.currentBlock.push(nextAnim);
                                undoBlock.push(<span style="font-weight: bold;">new</span> <span style="font-weight: bold; text-decoration: underline;">UndoMove</span>(nextAnim.objectID, nextAnim.toX, nextAnim.toY, nextAnim.fromX, nextAnim.fromY));
                                anyAnimations = <span style="font-weight: bold; text-decoration: underline;">true</span>;
                        }

                        <span style="font-weight: bold;">else</span> <span style="font-weight: bold;">if</span> (nextCommand[0].toUpperCase() == <span style="font-style: italic;">"STEP"</span>)
                        {
                                foundBreak = <span style="font-weight: bold; text-decoration: underline;">true</span>;
                        }
                        <span style="font-weight: bold;">else</span> <span style="font-weight: bold;">if</span> (nextCommand[0].toUpperCase() == <span style="font-style: italic;">"SETFOREGROUNDCOLOR"</span>)
                        {
                                <span style="font-weight: bold;">var</span> <span style="font-weight: bold; font-style: italic;">id</span> = parseInt(nextCommand[1]);
                                <span style="font-weight: bold;">var</span> <span style="font-weight: bold; font-style: italic;">oldColor</span> = <span style="font-weight: bold; text-decoration: underline;">this</span>.animatedObjects.foregroundColor(id);
                                <span style="font-weight: bold; text-decoration: underline;">this</span>.animatedObjects.setForegroundColor(id, <span style="font-weight: bold; text-decoration: underline;">this</span>.parseColor(nextCommand[2]));
                                undoBlock.push(<span style="font-weight: bold;">new</span> <span style="font-weight: bold; text-decoration: underline;">UndoSetForegroundColor</span>(id, oldColor));
                        }
                        <span style="font-weight: bold;">else</span> <span style="font-weight: bold;">if</span> (nextCommand[0].toUpperCase() == <span style="font-style: italic;">"SETBACKGROUNDCOLOR"</span>)
                        {
                                id = parseInt(nextCommand[1]);
                                oldColor = <span style="font-weight: bold; text-decoration: underline;">this</span>.animatedObjects.backgroundColor(id);
                                <span style="font-weight: bold; text-decoration: underline;">this</span>.animatedObjects.setBackgroundColor(id, <span style="font-weight: bold; text-decoration: underline;">this</span>.parseColor(nextCommand[2]));
                                undoBlock.push(<span style="font-weight: bold;">new</span> <span style="font-weight: bold; text-decoration: underline;">UndoSetBackgroundColor</span>(id, oldColor));
                        }
                        <span style="font-weight: bold;">else</span> <span style="font-weight: bold;">if</span> (nextCommand[0].toUpperCase() == <span style="font-style: italic;">"SETHIGHLIGHT"</span>)
                        {
                                <span style="font-weight: bold;">var</span> <span style="font-weight: bold; font-style: italic;">newHighlight</span> = <span style="font-weight: bold; text-decoration: underline;">this</span>.parseBool(nextCommand[2]);
                                <span style="font-weight: bold; text-decoration: underline;">this</span>.animatedObjects.setHighlight( parseInt(nextCommand[1]), newHighlight);
                                undoBlock.push(<span style="font-weight: bold;">new</span> <span style="font-weight: bold; text-decoration: underline;">UndoHighlight</span>( parseInt(nextCommand[1]), !newHighlight));
                        }
                        <span style="font-weight: bold;">else</span> <span style="font-weight: bold;">if</span> (nextCommand[0].toUpperCase() == <span style="font-style: italic;">"DISCONNECT"</span>)
                        {
                                <span style="font-weight: bold;">var</span> <span style="font-weight: bold; font-style: italic;">undoConnect</span> = <span style="font-weight: bold; text-decoration: underline;">this</span>.animatedObjects.disconnect(parseInt(nextCommand[1]), parseInt(nextCommand[2]));
                                <span style="font-weight: bold;">if</span> (undoConnect != <span style="font-weight: bold; text-decoration: underline;">null</span>)
                                {
                                        undoBlock.push(undoConnect);
                                }
                        }
                        <span style="font-weight: bold;">else</span> <span style="font-weight: bold;">if</span> (nextCommand[0].toUpperCase() == <span style="font-style: italic;">"SETALPHA"</span>)
                        {
                                <span style="font-weight: bold;">var</span> <span style="font-weight: bold; font-style: italic;">oldAlpha</span> = <span style="font-weight: bold; text-decoration: underline;">this</span>.animatedObjects.getAlpha(parseInt(nextCommand[1]));
                                <span style="font-weight: bold; text-decoration: underline;">this</span>.animatedObjects.setAlpha(parseInt(nextCommand[1]), parseFloat(nextCommand[2]));
                                undoBlock.push(<span style="font-weight: bold;">new</span> <span style="font-weight: bold; text-decoration: underline;">UndoSetAlpha</span>(parseInt(nextCommand[1]), oldAlpha));                                   
                        }
                        <span style="font-weight: bold;">else</span> <span style="font-weight: bold;">if</span> (nextCommand[0].toUpperCase() == <span style="font-style: italic;">"SETTEXT"</span>)
                        {
                                <span style="font-weight: bold;">if</span> (nextCommand.length &gt; 3)
                                {
                                        <span style="font-weight: bold;">var</span> <span style="font-weight: bold; font-style: italic;">oldText</span> = <span style="font-weight: bold; text-decoration: underline;">this</span>.animatedObjects.getText(parseInt(nextCommand[1]), parseInt(nextCommand[3]));
                                        <span style="font-weight: bold; text-decoration: underline;">this</span>.animatedObjects.setText(parseInt(nextCommand[1]), nextCommand[2], parseInt(nextCommand[3]));
                                        <span style="font-weight: bold;">if</span> (oldText != <span style="font-weight: bold; text-decoration: underline;">undefined</span>)
                                        {
                                                undoBlock.push(<span style="font-weight: bold;">new</span> <span style="font-weight: bold; text-decoration: underline;">UndoSetText</span>(parseInt(nextCommand[1]), oldText, parseInt(nextCommand[3]) ));                  
                                        }       
                                }
                                <span style="font-weight: bold;">else</span>
                                {
                                        oldText = <span style="font-weight: bold; text-decoration: underline;">this</span>.animatedObjects.getText(parseInt(nextCommand[1]), 0);
                                        <span style="font-weight: bold; text-decoration: underline;">this</span>.animatedObjects.setText(parseInt(nextCommand[1]), nextCommand[2], 0);
                                        <span style="font-weight: bold;">if</span> (oldText != <span style="font-weight: bold; text-decoration: underline;">undefined</span>)
                                        {
                                                undoBlock.push(<span style="font-weight: bold;">new</span> <span style="font-weight: bold; text-decoration: underline;">UndoSetText</span>(parseInt(nextCommand[1]), oldText, 0));  
                                        }
                                }
                        }
                        <span style="font-weight: bold;">else</span> <span style="font-weight: bold;">if</span> (nextCommand[0].toUpperCase() == <span style="font-style: italic;">"DELETE"</span>)
                        {
                                <span style="font-weight: bold;">var</span> <span style="font-weight: bold; font-style: italic;">objectID</span>  = parseInt(nextCommand[1]);
                                
                                <span style="font-weight: bold;">var</span> <span style="font-weight: bold; font-style: italic;">i</span>;
                                <span style="font-weight: bold;">var</span> <span style="font-weight: bold; font-style: italic;">removedEdges</span> = <span style="font-weight: bold; text-decoration: underline;">this</span>.animatedObjects.deleteIncident(objectID);
                                <span style="font-weight: bold;">if</span> (removedEdges.length &gt; 0)
                                {
                                        undoBlock = undoBlock.concat(removedEdges);
                                }
                                <span style="font-weight: bold;">var</span> <span style="font-weight: bold; font-style: italic;">obj</span> = <span style="font-weight: bold; text-decoration: underline;">this</span>.animatedObjects.getObject(objectID);
                                <span style="font-weight: bold;">if</span> (obj != <span style="font-weight: bold; text-decoration: underline;">null</span>)
                                {
                                        undoBlock.push(obj.createUndoDelete());
                                        <span style="font-weight: bold; text-decoration: underline;">this</span>.animatedObjects.removeObject(objectID);
                                }
                        }
                        <span style="font-weight: bold;">else</span> <span style="font-weight: bold;">if</span> (nextCommand[0].toUpperCase() == <span style="font-style: italic;">"CREATEHIGHLIGHTCIRCLE"</span>)
                        {
                                <span style="font-weight: bold;">if</span> (nextCommand.length &gt; 5)
                                {
                                        <span style="font-weight: bold; text-decoration: underline;">this</span>.animatedObjects.addHighlightCircleObject(parseInt(nextCommand[1]), <span style="font-weight: bold; text-decoration: underline;">this</span>.parseColor(nextCommand[2]), parseFloat(nextCommand[5]));
                                }
                                <span style="font-weight: bold;">else</span>
                                {
                                        <span style="font-weight: bold; text-decoration: underline;">this</span>.animatedObjects.addHighlightCircleObject(parseInt(nextCommand[1]), <span style="font-weight: bold; text-decoration: underline;">this</span>.parseColor(nextCommand[2]), 20);                                           
                                }
                                <span style="font-weight: bold;">if</span> (nextCommand.length &gt; 4)
                                {
                                        <span style="font-weight: bold; text-decoration: underline;">this</span>.animatedObjects.setNodePosition(parseInt(nextCommand[1]), parseInt(nextCommand[3]), parseInt(nextCommand[4]));
                                }
                                undoBlock.push(<span style="font-weight: bold;">new</span> <span style="font-weight: bold; text-decoration: underline;">UndoCreate</span>(parseInt(nextCommand[1])));
                                
                                
                        }
                        <span style="font-weight: bold;">else</span> <span style="font-weight: bold;">if</span> (nextCommand[0].toUpperCase() == <span style="font-style: italic;">"CREATELABEL"</span>)
                        {
                                <span style="font-weight: bold;">if</span> (nextCommand.length == 6)
                                {
                                        <span style="font-weight: bold; text-decoration: underline;">this</span>.animatedObjects.addLabelObject(parseInt(nextCommand[1]), nextCommand[2], <span style="font-weight: bold; text-decoration: underline;">this</span>.parseBool(nextCommand[5]));                                          
                                }
                                <span style="font-weight: bold;">else</span>
                                {
                                        <span style="font-weight: bold; text-decoration: underline;">this</span>.animatedObjects.addLabelObject(parseInt(nextCommand[1]), nextCommand[2], <span style="font-weight: bold; text-decoration: underline;">true</span>);
                                }
                                <span style="font-weight: bold;">if</span> (nextCommand.length &gt;= 5)
                                {
                                        
                                        <span style="font-weight: bold; text-decoration: underline;">this</span>.animatedObjects.setNodePosition(parseInt(nextCommand[1]), parseFloat(nextCommand[3]), parseFloat(nextCommand[4]));
                                }
                                undoBlock.push(<span style="font-weight: bold;">new</span> <span style="font-weight: bold; text-decoration: underline;">UndoCreate</span>(parseInt(nextCommand[1])));
                        }
                        <span style="font-weight: bold;">else</span> <span style="font-weight: bold;">if</span> (nextCommand[0].toUpperCase() == <span style="font-style: italic;">"SETEDGECOLOR"</span>)
                        {
                                <span style="font-weight: bold;">var</span> <span style="font-weight: bold; font-style: italic;">from</span> = parseInt(nextCommand[1]);
                                <span style="font-weight: bold;">var</span> <span style="font-weight: bold; font-style: italic;">to</span> = parseInt(nextCommand[2]);
                                <span style="font-weight: bold;">var</span> <span style="font-weight: bold; font-style: italic;">newColor</span> = <span style="font-weight: bold; text-decoration: underline;">this</span>.parseColor(nextCommand[3]);
                                <span style="font-weight: bold;">var</span> <span style="font-weight: bold; font-style: italic;">oldColor</span> = <span style="font-weight: bold; text-decoration: underline;">this</span>.animatedObjects.setEdgeColor(from, to, newColor);                           
                                undoBlock.push(<span style="font-weight: bold;">new</span> <span style="font-weight: bold; text-decoration: underline;">UndoSetEdgeColor</span>(from, to, oldColor));
                        }
                        <span style="font-weight: bold;">else</span> <span style="font-weight: bold;">if</span> (nextCommand[0].toUpperCase() == <span style="font-style: italic;">"SETEDGEALPHA"</span>)
                        {
                                <span style="font-weight: bold;">var</span> <span style="font-weight: bold; font-style: italic;">from</span> = parseInt(nextCommand[1]);
                                <span style="font-weight: bold;">var</span> <span style="font-weight: bold; font-style: italic;">to</span> = parseInt(nextCommand[2]);
                                <span style="font-weight: bold;">var</span> <span style="font-weight: bold; font-style: italic;">newAlpha</span> = parseFloat(nextCommand[3]);
                                <span style="font-weight: bold;">var</span> <span style="font-weight: bold; font-style: italic;">oldAplpha</span> = <span style="font-weight: bold; text-decoration: underline;">this</span>.animatedObjects.setEdgeAlpha(from, to, newAlpha);                          
                                undoBlock.push(<span style="font-weight: bold;">new</span> <span style="font-weight: bold; text-decoration: underline;">UndoSetEdgeAlpha</span>(from, to, oldAplpha));
                        }
                        
                        
                        <span style="font-weight: bold;">else</span> <span style="font-weight: bold;">if</span> (nextCommand[0].toUpperCase() == <span style="font-style: italic;">"SETEDGEHIGHLIGHT"</span>)
                        {
                                <span style="font-weight: bold;">var</span> <span style="font-weight: bold; font-style: italic;">newHighlight</span> = <span style="font-weight: bold; text-decoration: underline;">this</span>.parseBool(nextCommand[3]);
                                <span style="font-weight: bold;">var</span> <span style="font-weight: bold; font-style: italic;">from</span> = parseInt(nextCommand[1]);
                                <span style="font-weight: bold;">var</span> <span style="font-weight: bold; font-style: italic;">to</span> = parseInt(nextCommand[2]);
                                <span style="font-weight: bold;">var</span> <span style="font-weight: bold; font-style: italic;">oldHighlight</span> = <span style="font-weight: bold; text-decoration: underline;">this</span>.animatedObjects.setEdgeHighlight(from, to, newHighlight);
                                undoBlock.push(<span style="font-weight: bold;">new</span> <span style="font-weight: bold; text-decoration: underline;">UndoHighlightEdge</span>(from, to, oldHighlight));
                        }
                        <span style="font-weight: bold;">else</span> <span style="font-weight: bold;">if</span> (nextCommand[0].toUpperCase() == <span style="font-style: italic;">"SETHEIGHT"</span>)
                        {
                                id = parseInt(nextCommand[1]);
                                <span style="font-weight: bold;">var</span> <span style="font-weight: bold; font-style: italic;">oldHeight</span> = <span style="font-weight: bold; text-decoration: underline;">this</span>.animatedObjects.getHeight(id);
                                <span style="font-weight: bold; text-decoration: underline;">this</span>.animatedObjects.setHeight(id, parseInt(nextCommand[2]));
                                undoBlock.push(<span style="font-weight: bold;">new</span> <span style="font-weight: bold; text-decoration: underline;">UndoSetHeight</span>(id, oldHeight));
                        }
                        <span style="font-weight: bold;">else</span> <span style="font-weight: bold;">if</span> (nextCommand[0].toUpperCase() == <span style="font-style: italic;">"SETLAYER"</span>)
                        {
                                <span style="font-weight: bold; text-decoration: underline;">this</span>.animatedObjects.setLayer(parseInt(nextCommand[1]), parseInt(nextCommand[2]));
                                <span style="font-weight: bold; font-style: italic;">//</span><span style="font-weight: bold; font-style: italic;">TODO: Add undo information here</span>
                        }
                        
                        
                        <span style="font-weight: bold;">else</span> <span style="font-weight: bold;">if</span> (nextCommand[0].toUpperCase() == <span style="font-style: italic;">"CREATELINKEDLIST"</span>)
                        {
                                <span style="font-weight: bold;">if</span> (nextCommand.length == 11)
                                {
                                        <span style="font-weight: bold; text-decoration: underline;">this</span>.animatedObjects.addLinkedListObject(parseInt(nextCommand[1]), nextCommand[2], 
                                       parseInt(nextCommand[3]), parseInt(nextCommand[4]), parseFloat(nextCommand[7]), 
                                       <span style="font-weight: bold; text-decoration: underline;">this</span>.parseBool(nextCommand[8]), <span style="font-weight: bold; text-decoration: underline;">this</span>.parseBool(nextCommand[9]),parseInt(nextCommand[10]), <span style="font-style: italic;">"#FFFFFF"</span>, <span style="font-style: italic;">"#000000"</span>);
                                }
                                <span style="font-weight: bold;">else</span>
                                {
                                        <span style="font-weight: bold; text-decoration: underline;">this</span>.animatedObjects.addLinkedListObject(parseInt(nextCommand[1]), nextCommand[2], parseInt(nextCommand[3]), parseInt(nextCommand[4]), 0.25, <span style="font-weight: bold; text-decoration: underline;">true</span>, <span style="font-weight: bold; text-decoration: underline;">false</span>, 1, <span style="font-style: italic;">"#FFFFFF"</span>, <span style="font-style: italic;">"#000000"</span>);
                                }
                                <span style="font-weight: bold;">if</span> (nextCommand.length &gt; 6)
                                {
                                        <span style="font-weight: bold; text-decoration: underline;">this</span>.animatedObjects.setNodePosition(parseInt(nextCommand[1]), parseInt(nextCommand[5]), parseInt(nextCommand[6]));
                                        undoBlock.push(<span style="font-weight: bold;">new</span> <span style="font-weight: bold; text-decoration: underline;">UndoCreate</span>(parseInt(nextCommand[1])));
                                }
                                
                        }
                        <span style="font-weight: bold;">else</span> <span style="font-weight: bold;">if</span> (nextCommand[0].toUpperCase() == <span style="font-style: italic;">"SETNULL"</span>)
                        {
                                <span style="font-weight: bold;">var</span> <span style="font-weight: bold; font-style: italic;">oldNull</span> = <span style="font-weight: bold; text-decoration: underline;">this</span>.animatedObjects.getNull(parseInt(nextCommand[1]));
                                <span style="font-weight: bold; text-decoration: underline;">this</span>.animatedObjects.setNull(parseInt(nextCommand[1]), <span style="font-weight: bold; text-decoration: underline;">this</span>.parseBool(nextCommand[2]));
                                undoBlock.push(<span style="font-weight: bold;">new</span> <span style="font-weight: bold; text-decoration: underline;">UndoSetNull</span>(parseInt(nextCommand[1]), oldNull));                                     
                        }
                        <span style="font-weight: bold;">else</span> <span style="font-weight: bold;">if</span> (nextCommand[0].toUpperCase() == <span style="font-style: italic;">"SETTEXTCOLOR"</span>)
                        {
                                <span style="font-weight: bold;">if</span> (nextCommand.length &gt; 3)
                                {
                                        oldColor = <span style="font-weight: bold; text-decoration: underline;">this</span>.animatedObjects.getTextColor(parseInt(nextCommand[1]), parseInt(nextCommand[3]));
                                        <span style="font-weight: bold; text-decoration: underline;">this</span>.animatedObjects.setTextColor(parseInt(nextCommand[1]), <span style="font-weight: bold; text-decoration: underline;">this</span>.parseColor(nextCommand[2]), parseInt(nextCommand[3]));
                                        undoBlock.push(<span style="font-weight: bold;">new</span> <span style="font-weight: bold; text-decoration: underline;">UndoSetTextColor</span>(parseInt(nextCommand[1]), oldColor, parseInt(nextCommand[3]) ));                                    
                                }
                                <span style="font-weight: bold;">else</span>
                                {
                                        oldColor = <span style="font-weight: bold; text-decoration: underline;">this</span>.animatedObjects.getTextColor(parseInt(nextCommand[1]), 0);
                                        <span style="font-weight: bold; text-decoration: underline;">this</span>.animatedObjects.setTextColor(parseInt(nextCommand[1]),<span style="font-weight: bold; text-decoration: underline;">this</span>.parseColor(nextCommand[2]), 0);
                                        undoBlock.push(<span style="font-weight: bold;">new</span> <span style="font-weight: bold; text-decoration: underline;">UndoSetTextColor</span>(parseInt(nextCommand[1]), oldColor, 0));                                    
                                }
                        }
                        
                        
                        <span style="font-weight: bold;">else</span> <span style="font-weight: bold;">if</span> (nextCommand[0].toUpperCase() == <span style="font-style: italic;">"CREATEBTREENODE"</span>)
                        {

                                <span style="font-weight: bold; text-decoration: underline;">this</span>.animatedObjects.addBTreeNode(parseInt(nextCommand[1]), parseFloat(nextCommand[2]), parseFloat(nextCommand[3]), 
                                         parseInt(nextCommand[4]),<span style="font-weight: bold; text-decoration: underline;">this</span>.parseColor(nextCommand[7]), <span style="font-weight: bold; text-decoration: underline;">this</span>.parseColor(nextCommand[8]));
                                <span style="font-weight: bold; text-decoration: underline;">this</span>.animatedObjects.setNodePosition(parseInt(nextCommand[1]), parseInt(nextCommand[5]), parseInt(nextCommand[6]));
                                undoBlock.push(<span style="font-weight: bold;">new</span> <span style="font-weight: bold; text-decoration: underline;">UndoCreate</span>(parseInt(nextCommand[1])));
                        }

                        <span style="font-weight: bold;">else</span> <span style="font-weight: bold;">if</span> (nextCommand[0].toUpperCase() == <span style="font-style: italic;">"SETWIDTH"</span>)
                        {
                                <span style="font-weight: bold;">var</span> <span style="font-weight: bold; font-style: italic;">id</span> = parseInt(nextCommand[1]);
                                <span style="font-weight: bold; text-decoration: underline;">this</span>.animatedObjects.setWidth(id, parseInt(nextCommand[2]));
                                <span style="font-weight: bold;">var</span> <span style="font-weight: bold; font-style: italic;">oldWidth</span> = <span style="font-weight: bold; text-decoration: underline;">this</span>.animatedObjects.getWidth(id);
                                undoBlock.push(<span style="font-weight: bold;">new</span> <span style="font-weight: bold; text-decoration: underline;">UndoSetWidth</span>(id, oldWidth));
                        }
                        <span style="font-weight: bold;">else</span> <span style="font-weight: bold;">if</span> (nextCommand[0].toUpperCase() == <span style="font-style: italic;">"SETNUMELEMENTS"</span>)
                        {
                                <span style="font-weight: bold;">var</span> <span style="font-weight: bold; font-style: italic;">oldElem</span> = <span style="font-weight: bold; text-decoration: underline;">this</span>.animatedObjects.getObject(parseInt(nextCommand[1]));
                                undoBlock.push(<span style="font-weight: bold;">new</span> <span style="font-weight: bold; text-decoration: underline;">UndoSetNumElements</span>(oldElem, parseInt(nextCommand[2])));
                                <span style="font-weight: bold; text-decoration: underline;">this</span>.animatedObjects.setNumElements(parseInt(nextCommand[1]), parseInt(nextCommand[2]));
                        }
                        <span style="font-weight: bold;">else</span> <span style="font-weight: bold;">if</span> (nextCommand[0].toUpperCase() == <span style="font-style: italic;">"SETPOSITION"</span>)
                        {
                                <span style="font-weight: bold;">var</span> <span style="font-weight: bold; font-style: italic;">id</span> = parseInt(nextCommand[1])
                                <span style="font-weight: bold;">var</span> <span style="font-weight: bold; font-style: italic;">oldX</span> = <span style="font-weight: bold; text-decoration: underline;">this</span>.animatedObjects.getNodeX(id);
                                <span style="font-weight: bold;">var</span> <span style="font-weight: bold; font-style: italic;">oldY</span> = <span style="font-weight: bold; text-decoration: underline;">this</span>.animatedObjects.getNodeY(id);
                                undoBlock.push(<span style="font-weight: bold;">new</span> <span style="font-weight: bold; text-decoration: underline;">UndoSetPosition</span>(id, oldX, oldY));
                                <span style="font-weight: bold; text-decoration: underline;">this</span>.animatedObjects.setNodePosition(id, parseInt(nextCommand[2]), parseInt(nextCommand[3]));
                        }
                        <span style="font-weight: bold;">else</span> <span style="font-weight: bold;">if</span> (nextCommand[0].toUpperCase() == <span style="font-style: italic;">"ALIGNRIGHT"</span>)
                        {
                                <span style="font-weight: bold;">var</span> <span style="font-weight: bold; font-style: italic;">id</span> = parseInt(nextCommand[1])
                                <span style="font-weight: bold;">var</span> <span style="font-weight: bold; font-style: italic;">oldX</span> = <span style="font-weight: bold; text-decoration: underline;">this</span>.animatedObjects.getNodeX(id);
                                <span style="font-weight: bold;">var</span> <span style="font-weight: bold; font-style: italic;">oldY</span> = <span style="font-weight: bold; text-decoration: underline;">this</span>.animatedObjects.getNodeY(id);
                                undoBlock.push(<span style="font-weight: bold;">new</span> <span style="font-weight: bold; text-decoration: underline;">UndoSetPosition</span>(id, oldX. oldY));
                                <span style="font-weight: bold; text-decoration: underline;">this</span>.animatedObjects.alignRight(id, parseInt(nextCommand[2]));
                        }
                        <span style="font-weight: bold;">else</span> <span style="font-weight: bold;">if</span> (nextCommand[0].toUpperCase() == <span style="font-style: italic;">"ALIGNLEFT"</span>)
                        {
                                <span style="font-weight: bold;">var</span> <span style="font-weight: bold; font-style: italic;">id</span> = parseInt(nextCommand[1])
                                <span style="font-weight: bold;">var</span> <span style="font-weight: bold; font-style: italic;">oldX</span> = <span style="font-weight: bold; text-decoration: underline;">this</span>.animatedObjects.getNodeX(id);
                                <span style="font-weight: bold;">var</span> <span style="font-weight: bold; font-style: italic;">oldY</span> = <span style="font-weight: bold; text-decoration: underline;">this</span>.animatedObjects.getNodeY(id);
                                undoBlock.push(<span style="font-weight: bold;">new</span> <span style="font-weight: bold; text-decoration: underline;">UndoSetPosition</span>(id, oldX. oldY));
                                <span style="font-weight: bold; text-decoration: underline;">this</span>.animatedObjects.alignLeft(id, parseInt(nextCommand[2]));
                        }
                        <span style="font-weight: bold;">else</span> <span style="font-weight: bold;">if</span> (nextCommand[0].toUpperCase() == <span style="font-style: italic;">"ALIGNTOP"</span>)
                        {
                                <span style="font-weight: bold;">var</span> <span style="font-weight: bold; font-style: italic;">id</span> = parseInt(nextCommand[1])
                                <span style="font-weight: bold;">var</span> <span style="font-weight: bold; font-style: italic;">oldX</span> = <span style="font-weight: bold; text-decoration: underline;">this</span>.animatedObjects.getNodeX(id);
                                <span style="font-weight: bold;">var</span> <span style="font-weight: bold; font-style: italic;">oldY</span> = <span style="font-weight: bold; text-decoration: underline;">this</span>.animatedObjects.getNodeY(id);
                                undoBlock.push(<span style="font-weight: bold;">new</span> <span style="font-weight: bold; text-decoration: underline;">UndoSetPosition</span>(id, oldX. oldY));
                                <span style="font-weight: bold; text-decoration: underline;">this</span>.animatedObjects.alignTop(id, parseInt(nextCommand[2]));
                        }
                        <span style="font-weight: bold;">else</span> <span style="font-weight: bold;">if</span> (nextCommand[0].toUpperCase() == <span style="font-style: italic;">"ALIGNBOTTOM"</span>)
                        {
                                <span style="font-weight: bold;">var</span> <span style="font-weight: bold; font-style: italic;">id</span> = parseInt(nextCommand[1])
                                <span style="font-weight: bold;">var</span> <span style="font-weight: bold; font-style: italic;">oldX</span> = <span style="font-weight: bold; text-decoration: underline;">this</span>.animatedObjects.getNodeX(id);
                                <span style="font-weight: bold;">var</span> <span style="font-weight: bold; font-style: italic;">oldY</span> = <span style="font-weight: bold; text-decoration: underline;">this</span>.animatedObjects.getNodeY(id);
                                undoBlock.push(<span style="font-weight: bold;">new</span> <span style="font-weight: bold; text-decoration: underline;">UndoSetPosition</span>(id, oldX. oldY));
                                <span style="font-weight: bold; text-decoration: underline;">this</span>.animatedObjects.alignBottom(id, parseInt(nextCommand[2]));
                        }





                        <span style="font-weight: bold;">else</span> <span style="font-weight: bold;">if</span> (nextCommand[0].toUpperCase() == <span style="font-style: italic;">"SETHIGHLIGHTINDEX"</span>)
                        {
                                <span style="font-weight: bold;">var</span> <span style="font-weight: bold; font-style: italic;">id</span> = parseInt(nextCommand[1]);
                                <span style="font-weight: bold;">var</span> <span style="font-weight: bold; font-style: italic;">index</span> = parseInt(nextCommand[2]);
                                <span style="font-weight: bold;">var</span> <span style="font-weight: bold; font-style: italic;">oldIndex</span> = <span style="font-weight: bold; text-decoration: underline;">this</span>.animatedObjects.getHighlightIndex(id)
                                undoBlock.push(<span style="font-weight: bold;">new</span> <span style="font-weight: bold; text-decoration: underline;">UndoSetHighlightIndex</span>(id, oldIndex));
                                <span style="font-weight: bold; text-decoration: underline;">this</span>.animatedObjects.setHighlightIndex(id,index);
                        }
                        <span style="font-weight: bold;">else</span>
                        {
        <span style="font-weight: bold; font-style: italic;">//                      </span><span style="font-weight: bold; font-style: italic;">throw "Unknown command: " + nextCommand[0];                                     </span>
                        }
                        
                        <span style="font-weight: bold; text-decoration: underline;">this</span>.currentAnimation = <span style="font-weight: bold; text-decoration: underline;">this</span>.currentAnimation+1;
                }
                <span style="font-weight: bold; text-decoration: underline;">this</span>.currFrame = 0;

                <span style="font-weight: bold; font-style: italic;">// </span><span style="font-weight: bold; font-style: italic;">Hack:  If there are not any animations, and we are currently paused,</span>
                <span style="font-weight: bold; font-style: italic;">// </span><span style="font-weight: bold; font-style: italic;">then set the current frame to the end of the anumation, so that we will</span>
                <span style="font-weight: bold; font-style: italic;">// </span><span style="font-weight: bold; font-style: italic;">advance immediagely upon the next step button.  If we are not paused, then</span>
                <span style="font-weight: bold; font-style: italic;">// </span><span style="font-weight: bold; font-style: italic;">animate as normal.</span>

                <span style="font-weight: bold;">if</span> (!anyAnimations &amp;&amp; <span style="font-weight: bold; text-decoration: underline;">this</span>.animationPaused || (!anyAnimations &amp;&amp; <span style="font-weight: bold; text-decoration: underline;">this</span>.currentAnimation == <span style="font-weight: bold; text-decoration: underline;">this</span>.AnimationSteps.length) )
                {
                        <span style="font-weight: bold; text-decoration: underline;">this</span>.currFrame = <span style="font-weight: bold; text-decoration: underline;">this</span>.animationBlockLength;
                }

                <span style="font-weight: bold; text-decoration: underline;">this</span>.undoStack.push(undoBlock);
        }
</pre>
</div>
</div>
</div>

<div id="outline-container-org8af6e7c" class="outline-3">
<h3 id="org8af6e7c"><span class="section-number-3">1.8</span> Function to start a new animation.</h3>
<div class="outline-text-3" id="text-1-8">
<div class="org-src-container">
<pre class="src src-js" id="org9e6c2aa">
        
        <span style="font-weight: bold; text-decoration: underline;">this</span>.StartNewAnimation =  <span style="font-weight: bold;">function</span>(<span style="font-weight: bold; font-style: italic;">commands</span>)
        {
                clearTimeout(timer);
                <span style="font-weight: bold;">if</span> (<span style="font-weight: bold; text-decoration: underline;">this</span>.AnimationSteps != <span style="font-weight: bold; text-decoration: underline;">null</span>)
                {
                        <span style="font-weight: bold; text-decoration: underline;">this</span>.previousAnimationSteps.push(<span style="font-weight: bold; text-decoration: underline;">this</span>.AnimationSteps);
                        <span style="font-weight: bold; text-decoration: underline;">this</span>.undoAnimationStepIndicesStack.push(<span style="font-weight: bold; text-decoration: underline;">this</span>.undoAnimationStepIndices);
                }
                <span style="font-weight: bold;">if</span> (commands == <span style="font-weight: bold; text-decoration: underline;">undefined</span> || commands.length == 0)
                {
                        <span style="font-weight: bold; text-decoration: underline;">this</span>.AnimationSteps = [<span style="font-style: italic;">"Step"</span>];
                }
                <span style="font-weight: bold;">else</span>
                {
                        <span style="font-weight: bold; text-decoration: underline;">this</span>.AnimationSteps = commands;
                }
                <span style="font-weight: bold; text-decoration: underline;">this</span>.undoAnimationStepIndices = <span style="font-weight: bold;">new</span> <span style="font-weight: bold; text-decoration: underline;">Array</span>();
                <span style="font-weight: bold; text-decoration: underline;">this</span>.currentAnimation = 0;
                <span style="font-weight: bold; text-decoration: underline;">this</span>.startNextBlock();
                <span style="font-weight: bold; text-decoration: underline;">this</span>.currentlyAnimating = <span style="font-weight: bold; text-decoration: underline;">true</span>;
                <span style="font-weight: bold; text-decoration: underline;">this</span>.fireEvent(<span style="font-style: italic;">"AnimationStarted"</span>,<span style="font-style: italic;">"NoData"</span>);
                timer = setTimeout(<span style="font-style: italic;">'timeout()'</span>, 30); 

        }
        
        
        <span style="font-weight: bold; font-style: italic;">// </span><span style="font-weight: bold; font-style: italic;">Step backwards one step.  A no-op if the animation is not currently paused</span>
        <span style="font-weight: bold; text-decoration: underline;">this</span>.stepBack = <span style="font-weight: bold;">function</span>()
        {
                <span style="font-weight: bold;">if</span> (<span style="font-weight: bold; text-decoration: underline;">this</span>.awaitingStep &amp;&amp; <span style="font-weight: bold; text-decoration: underline;">this</span>.undoStack != <span style="font-weight: bold; text-decoration: underline;">null</span> &amp;&amp; <span style="font-weight: bold; text-decoration: underline;">this</span>.undoStack.length != 0)
                {
                        <span style="font-weight: bold; font-style: italic;">//  </span><span style="font-weight: bold; font-style: italic;">TODO:  Get events working correctly!</span>
                        <span style="font-weight: bold; text-decoration: underline;">this</span>.fireEvent(<span style="font-style: italic;">"AnimationStarted"</span>,<span style="font-style: italic;">"NoData"</span>);
                        clearTimeout(timer);

                        <span style="font-weight: bold; text-decoration: underline;">this</span>.awaitingStep = <span style="font-weight: bold; text-decoration: underline;">false</span>;
                        <span style="font-weight: bold; text-decoration: underline;">this</span>.undoLastBlock();
                        <span style="font-weight: bold; font-style: italic;">// </span><span style="font-weight: bold; font-style: italic;">Re-kick thie timer.  The timer may or may not be running at this point,</span>
                        <span style="font-weight: bold; font-style: italic;">// </span><span style="font-weight: bold; font-style: italic;">so to be safe we'll kill it and start it again.</span>
                        clearTimeout(timer);
                        timer = setTimeout(<span style="font-style: italic;">'timeout()'</span>, 30); 

                        
                }
                <span style="font-weight: bold;">else</span> <span style="font-weight: bold;">if</span> (!<span style="font-weight: bold; text-decoration: underline;">this</span>.currentlyAnimating &amp;&amp; <span style="font-weight: bold; text-decoration: underline;">this</span>.animationPaused &amp;&amp; <span style="font-weight: bold; text-decoration: underline;">this</span>.undoAnimationStepIndices != <span style="font-weight: bold; text-decoration: underline;">null</span>)
                {
                        <span style="font-weight: bold; text-decoration: underline;">this</span>.fireEvent(<span style="font-style: italic;">"AnimationStarted"</span>,<span style="font-style: italic;">"NoData"</span>);
                        <span style="font-weight: bold; text-decoration: underline;">this</span>.currentlyAnimating = <span style="font-weight: bold; text-decoration: underline;">true</span>;
                        <span style="font-weight: bold; text-decoration: underline;">this</span>.undoLastBlock();
                        <span style="font-weight: bold; font-style: italic;">// </span><span style="font-weight: bold; font-style: italic;">Re-kick thie timer.  The timer may or may not be running at this point,</span>
                        <span style="font-weight: bold; font-style: italic;">// </span><span style="font-weight: bold; font-style: italic;">so to be safe we'll kill it and start it again.</span>
                        clearTimeout(timer);
                        timer = setTimeout(<span style="font-style: italic;">'timeout()'</span>, 30); 
                        
                }
                
        }
        <span style="font-weight: bold; font-style: italic;">// </span><span style="font-weight: bold; font-style: italic;">Step forwards one step.  A no-op if the animation is not currently paused</span>
        <span style="font-weight: bold; text-decoration: underline;">this</span>.step = <span style="font-weight: bold;">function</span>()
        {
                <span style="font-weight: bold;">if</span> (<span style="font-weight: bold; text-decoration: underline;">this</span>.awaitingStep)
                {
                        <span style="font-weight: bold; text-decoration: underline;">this</span>.startNextBlock();
                        <span style="font-weight: bold; text-decoration: underline;">this</span>.fireEvent(<span style="font-style: italic;">"AnimationStarted"</span>,<span style="font-style: italic;">"NoData"</span>);
                        <span style="font-weight: bold; text-decoration: underline;">this</span>.currentlyAnimating = <span style="font-weight: bold; text-decoration: underline;">true</span>;
                        <span style="font-weight: bold; font-style: italic;">// </span><span style="font-weight: bold; font-style: italic;">Re-kick thie timer.  The timer should be going now, but we've had some difficulty with</span>
                        <span style="font-weight: bold; font-style: italic;">// </span><span style="font-weight: bold; font-style: italic;">it timing itself out, so we'll be safe and kick it now.</span>
                        clearTimeout(timer);
                        timer = setTimeout(<span style="font-style: italic;">'timeout()'</span>, 30);                    
                }
        }
        
        
        <span style="font-weight: bold; font-style: italic;">/// </span><span style="font-weight: bold; font-style: italic;">WARNING:  Could be dangerous to call while an animation is running ...</span>
        <span style="font-weight: bold; text-decoration: underline;">this</span>.clearHistory = <span style="font-weight: bold;">function</span>()
        {
                <span style="font-weight: bold; text-decoration: underline;">this</span>.undoStack = [];
                <span style="font-weight: bold; text-decoration: underline;">this</span>.undoAnimationStepIndices = <span style="font-weight: bold; text-decoration: underline;">null</span>;
                <span style="font-weight: bold; text-decoration: underline;">this</span>.previousAnimationSteps = [];
                <span style="font-weight: bold; text-decoration: underline;">this</span>.undoAnimationStepIndicesStack = [];
                <span style="font-weight: bold; text-decoration: underline;">this</span>.AnimationSteps = <span style="font-weight: bold; text-decoration: underline;">null</span>;
                <span style="font-weight: bold; text-decoration: underline;">this</span>.fireEvent(<span style="font-style: italic;">"AnimationUndoUnavailable"</span>,<span style="font-style: italic;">"NoData"</span>);
                clearTimeout(timer);
                <span style="font-weight: bold; text-decoration: underline;">this</span>.animatedObjects.update();
                <span style="font-weight: bold; text-decoration: underline;">this</span>.animatedObjects.draw();
                
        }
        
        <span style="font-weight: bold; text-decoration: underline;">this</span>.skipBack = <span style="font-weight: bold;">function</span>()
        {
                <span style="font-weight: bold;">var</span> <span style="font-weight: bold; font-style: italic;">keepUndoing</span> = <span style="font-weight: bold; text-decoration: underline;">this</span>.undoAnimationStepIndices != <span style="font-weight: bold; text-decoration: underline;">null</span> &amp;&amp; <span style="font-weight: bold; text-decoration: underline;">this</span>. undoAnimationStepIndices.length != 0;
                <span style="font-weight: bold;">if</span> (keepUndoing)
                {
                        <span style="font-weight: bold;">var</span> <span style="font-weight: bold; font-style: italic;">i</span>;
                        <span style="font-weight: bold;">for</span> (i = 0; <span style="font-weight: bold; text-decoration: underline;">this</span>.currentBlock != <span style="font-weight: bold; text-decoration: underline;">null</span> &amp;&amp; i &lt; <span style="font-weight: bold; text-decoration: underline;">this</span>.currentBlock.length; i++)
                        {
                                <span style="font-weight: bold;">var</span> <span style="font-weight: bold; font-style: italic;">objectID</span> = <span style="font-weight: bold; text-decoration: underline;">this</span>.currentBlock[i].objectID;
                                <span style="font-weight: bold; text-decoration: underline;">this</span>.animatedObjects.setNodePosition(objectID,
                                                                                                <span style="font-weight: bold; text-decoration: underline;">this</span>.currentBlock[i].toX,
                                                                                                <span style="font-weight: bold; text-decoration: underline;">this</span>.currentBlock[i].toY);
                        }
                        <span style="font-weight: bold;">if</span> (<span style="font-weight: bold; text-decoration: underline;">this</span>.doingUndo)
                        {
                                <span style="font-weight: bold; text-decoration: underline;">this</span>.finishUndoBlock(<span style="font-weight: bold; text-decoration: underline;">this</span>.undoStack.pop())
                        }
                        <span style="font-weight: bold;">while</span> (keepUndoing)
                        {
                                <span style="font-weight: bold; text-decoration: underline;">this</span>.undoLastBlock();
                                <span style="font-weight: bold;">for</span> (i = 0; i &lt; <span style="font-weight: bold; text-decoration: underline;">this</span>.currentBlock.length; i++)
                                {
                                        objectID = <span style="font-weight: bold; text-decoration: underline;">this</span>.currentBlock[i].objectID;
                                        <span style="font-weight: bold; text-decoration: underline;">this</span>.animatedObjects.setNodePosition(objectID,
                                                                                                        <span style="font-weight: bold; text-decoration: underline;">this</span>.currentBlock[i].toX,
                                                                                                        <span style="font-weight: bold; text-decoration: underline;">this</span>.currentBlock[i].toY);
                                }
                                keepUndoing = <span style="font-weight: bold; text-decoration: underline;">this</span>.finishUndoBlock(<span style="font-weight: bold; text-decoration: underline;">this</span>.undoStack.pop());
                                
                        }
                        clearTimeout(timer);
                        <span style="font-weight: bold; text-decoration: underline;">this</span>.animatedObjects.update();
                        <span style="font-weight: bold; text-decoration: underline;">this</span>.animatedObjects.draw();
                        <span style="font-weight: bold;">if</span> (<span style="font-weight: bold; text-decoration: underline;">this</span>.undoStack == <span style="font-weight: bold; text-decoration: underline;">null</span> || <span style="font-weight: bold; text-decoration: underline;">this</span>.undoStack.length == 0)
                        {
                                <span style="font-weight: bold; text-decoration: underline;">this</span>.fireEvent(<span style="font-style: italic;">"AnimationUndoUnavailable"</span>,<span style="font-style: italic;">"NoData"</span>);
                        }

                }                       
        }
        
        <span style="font-weight: bold; text-decoration: underline;">this</span>.resetAll = <span style="font-weight: bold;">function</span>()
        {
                <span style="font-weight: bold; text-decoration: underline;">this</span>.clearHistory();
                <span style="font-weight: bold; text-decoration: underline;">this</span>.animatedObjects.clearAllObjects();
                <span style="font-weight: bold; text-decoration: underline;">this</span>.animatedObjects.draw();
                clearTimeout(timer);
        }
        
        <span style="font-weight: bold; text-decoration: underline;">this</span>.skipForward = <span style="font-weight: bold;">function</span>()
        {
                <span style="font-weight: bold;">if</span> (<span style="font-weight: bold; text-decoration: underline;">this</span>.currentlyAnimating)
                {
                        <span style="font-weight: bold; text-decoration: underline;">this</span>.animatedObjects.runFast = <span style="font-weight: bold; text-decoration: underline;">true</span>;
                        <span style="font-weight: bold;">while</span> (<span style="font-weight: bold; text-decoration: underline;">this</span>.AnimationSteps != <span style="font-weight: bold; text-decoration: underline;">null</span> &amp;&amp; <span style="font-weight: bold; text-decoration: underline;">this</span>.currentAnimation &lt; <span style="font-weight: bold; text-decoration: underline;">this</span>.AnimationSteps.length)
                        {
                                <span style="font-weight: bold;">var</span> <span style="font-weight: bold; font-style: italic;">i</span>;
                                <span style="font-weight: bold;">for</span> (i = 0; <span style="font-weight: bold; text-decoration: underline;">this</span>.currentBlock != <span style="font-weight: bold; text-decoration: underline;">null</span> &amp;&amp; i &lt; <span style="font-weight: bold; text-decoration: underline;">this</span>.currentBlock.length; i++)
                                {
                                        <span style="font-weight: bold;">var</span> <span style="font-weight: bold; font-style: italic;">objectID</span> = <span style="font-weight: bold; text-decoration: underline;">this</span>.currentBlock[i].objectID;
                                        <span style="font-weight: bold; text-decoration: underline;">this</span>.animatedObjects.setNodePosition(objectID,
                                                                                                        <span style="font-weight: bold; text-decoration: underline;">this</span>.currentBlock[i].toX,
                                                                                                        <span style="font-weight: bold; text-decoration: underline;">this</span>.currentBlock[i].toY);
                                }
                                <span style="font-weight: bold;">if</span> (<span style="font-weight: bold; text-decoration: underline;">this</span>.doingUndo)
                                {
                                        <span style="font-weight: bold; text-decoration: underline;">this</span>.finishUndoBlock(<span style="font-weight: bold; text-decoration: underline;">this</span>.undoStack.pop())
                                }
                                <span style="font-weight: bold; text-decoration: underline;">this</span>.startNextBlock();
                                <span style="font-weight: bold;">for</span> (i= 0; i &lt; <span style="font-weight: bold; text-decoration: underline;">this</span>.currentBlock.length; i++)
                                {
                                        <span style="font-weight: bold;">var</span> <span style="font-weight: bold; font-style: italic;">objectID</span> = <span style="font-weight: bold; text-decoration: underline;">this</span>.currentBlock[i].objectID;
                                        <span style="font-weight: bold; text-decoration: underline;">this</span>.animatedObjects.setNodePosition(objectID,
                                                                                                        <span style="font-weight: bold; text-decoration: underline;">this</span>.currentBlock[i].toX,
                                                                                                        <span style="font-weight: bold; text-decoration: underline;">this</span>.currentBlock[i].toY);
                                }               
                                
                        }
                        <span style="font-weight: bold; text-decoration: underline;">this</span>.animatedObjects.update();
                        <span style="font-weight: bold; text-decoration: underline;">this</span>.currentlyAnimating = <span style="font-weight: bold; text-decoration: underline;">false</span>;
                        <span style="font-weight: bold; text-decoration: underline;">this</span>.awaitingStep = <span style="font-weight: bold; text-decoration: underline;">false</span>;
                        <span style="font-weight: bold; text-decoration: underline;">this</span>.doingUndo = <span style="font-weight: bold; text-decoration: underline;">false</span>;
                        
                        <span style="font-weight: bold; text-decoration: underline;">this</span>.animatedObjects.runFast = <span style="font-weight: bold; text-decoration: underline;">false</span>;
                        <span style="font-weight: bold; text-decoration: underline;">this</span>.fireEvent(<span style="font-style: italic;">"AnimationEnded"</span>,<span style="font-style: italic;">"NoData"</span>);
                        clearTimeout(timer);
                        <span style="font-weight: bold; text-decoration: underline;">this</span>.animatedObjects.update();
                        <span style="font-weight: bold; text-decoration: underline;">this</span>.animatedObjects.draw();                    
                }
        }
        
        
        <span style="font-weight: bold; text-decoration: underline;">this</span>.finishUndoBlock = <span style="font-weight: bold;">function</span>(<span style="font-weight: bold; font-style: italic;">undoBlock</span>)
        {
                <span style="font-weight: bold;">for</span> (<span style="font-weight: bold;">var</span> <span style="font-weight: bold; font-style: italic;">i</span> = undoBlock.length - 1; i &gt;= 0; i--)
                {
                        undoBlock[i].undoInitialStep(<span style="font-weight: bold; text-decoration: underline;">this</span>.animatedObjects);
                        
                }
                <span style="font-weight: bold; text-decoration: underline;">this</span>.doingUndo = <span style="font-weight: bold; text-decoration: underline;">false</span>;
                
                <span style="font-weight: bold; font-style: italic;">// </span><span style="font-weight: bold; font-style: italic;">If we are at the final end of the animation ...</span>
                <span style="font-weight: bold;">if</span> (<span style="font-weight: bold; text-decoration: underline;">this</span>.undoAnimationStepIndices.length == 0)
                {
                        <span style="font-weight: bold; text-decoration: underline;">this</span>.awaitingStep = <span style="font-weight: bold; text-decoration: underline;">false</span>;
                        <span style="font-weight: bold; text-decoration: underline;">this</span>.currentlyAnimating = <span style="font-weight: bold; text-decoration: underline;">false</span>;
                        <span style="font-weight: bold; text-decoration: underline;">this</span>.undoAnimationStepIndices = <span style="font-weight: bold; text-decoration: underline;">this</span>.undoAnimationStepIndicesStack.pop();
                        <span style="font-weight: bold; text-decoration: underline;">this</span>.AnimationSteps = <span style="font-weight: bold; text-decoration: underline;">this</span>.previousAnimationSteps.pop();
                        <span style="font-weight: bold; text-decoration: underline;">this</span>.fireEvent(<span style="font-style: italic;">"AnimationEnded"</span>,<span style="font-style: italic;">"NoData"</span>);
                        <span style="font-weight: bold; text-decoration: underline;">this</span>.fireEvent(<span style="font-style: italic;">"AnimationUndo"</span>,<span style="font-style: italic;">"NoData"</span>);
                        <span style="font-weight: bold; text-decoration: underline;">this</span>.currentBlock = [];
                        <span style="font-weight: bold;">if</span> (<span style="font-weight: bold; text-decoration: underline;">this</span>.undoStack == <span style="font-weight: bold; text-decoration: underline;">null</span> || <span style="font-weight: bold; text-decoration: underline;">this</span>.undoStack.length == 0)
                        {
                                <span style="font-weight: bold; text-decoration: underline;">this</span>.currentlyAnimating = <span style="font-weight: bold; text-decoration: underline;">false</span>;
                                <span style="font-weight: bold; text-decoration: underline;">this</span>.awaitingStep = <span style="font-weight: bold; text-decoration: underline;">false</span>;
                                <span style="font-weight: bold; text-decoration: underline;">this</span>.fireEvent(<span style="font-style: italic;">"AnimationUndoUnavailable"</span>,<span style="font-style: italic;">"NoData"</span>);
                        }
                        
                        clearTimeout(timer);
                        <span style="font-weight: bold; text-decoration: underline;">this</span>.animatedObjects.update();
                        <span style="font-weight: bold; text-decoration: underline;">this</span>.animatedObjects.draw();
                        
                        
                        <span style="font-weight: bold;">return</span> <span style="font-weight: bold; text-decoration: underline;">false</span>;
                }
                <span style="font-weight: bold;">return</span> <span style="font-weight: bold; text-decoration: underline;">true</span>;
        }
        
        
        <span style="font-weight: bold; text-decoration: underline;">this</span>.undoLastBlock = <span style="font-weight: bold;">function</span>()
        {
                
                <span style="font-weight: bold;">if</span> (<span style="font-weight: bold; text-decoration: underline;">this</span>.undoAnimationStepIndices.length == 0)
                {
                        
                        <span style="font-weight: bold; font-style: italic;">// </span><span style="font-weight: bold; font-style: italic;">Nothing on the undo stack.  Return</span>
                        <span style="font-weight: bold;">return</span>;
                        
                }
                <span style="font-weight: bold;">if</span> (<span style="font-weight: bold; text-decoration: underline;">this</span>.undoAnimationStepIndices.length &gt; 0)
                {
                        <span style="font-weight: bold; text-decoration: underline;">this</span>.doingUndo = <span style="font-weight: bold; text-decoration: underline;">true</span>;
                        <span style="font-weight: bold;">var</span> <span style="font-weight: bold; font-style: italic;">anyAnimations</span> = <span style="font-weight: bold; text-decoration: underline;">false</span>;
                        <span style="font-weight: bold; text-decoration: underline;">this</span>.currentAnimation = <span style="font-weight: bold; text-decoration: underline;">this</span>.undoAnimationStepIndices.pop();
                        <span style="font-weight: bold; text-decoration: underline;">this</span>.currentBlock = [];
                        <span style="font-weight: bold;">var</span> <span style="font-weight: bold; font-style: italic;">undo</span> = <span style="font-weight: bold; text-decoration: underline;">this</span>.undoStack[<span style="font-weight: bold; text-decoration: underline;">this</span>.undoStack.length - 1];
                        <span style="font-weight: bold;">var</span> <span style="font-weight: bold; font-style: italic;">i</span>;
                        <span style="font-weight: bold;">for</span> (i = undo.length - 1; i &gt;= 0; i--)
                        {
                                <span style="font-weight: bold;">var</span> <span style="font-weight: bold; font-style: italic;">animateNext</span>  =  undo[i].addUndoAnimation(<span style="font-weight: bold; text-decoration: underline;">this</span>.currentBlock);
                                anyAnimations = anyAnimations || animateNext;
                                
                        }
                        <span style="font-weight: bold; text-decoration: underline;">this</span>.currFrame = 0;
                        
                        <span style="font-weight: bold; font-style: italic;">// </span><span style="font-weight: bold; font-style: italic;">Hack:  If there are not any animations, and we are currently paused,</span>
                        <span style="font-weight: bold; font-style: italic;">// </span><span style="font-weight: bold; font-style: italic;">then set the current frame to the end of the animation, so that we will</span>
                        <span style="font-weight: bold; font-style: italic;">// </span><span style="font-weight: bold; font-style: italic;">advance immediagely upon the next step button.  If we are not paused, then</span>
                        <span style="font-weight: bold; font-style: italic;">// </span><span style="font-weight: bold; font-style: italic;">animate as normal.</span>
                        <span style="font-weight: bold;">if</span> (!anyAnimations &amp;&amp; <span style="font-weight: bold; text-decoration: underline;">this</span>.animationPaused  )
                        {
                                <span style="font-weight: bold; text-decoration: underline;">this</span>.currFrame = <span style="font-weight: bold; text-decoration: underline;">this</span>.animationBlockLength;
                        }
                        <span style="font-weight: bold; text-decoration: underline;">this</span>.currentlyAnimating = <span style="font-weight: bold; text-decoration: underline;">true</span>;                         
                }
                
        }
        <span style="font-weight: bold; text-decoration: underline;">this</span>.setLayer = <span style="font-weight: bold;">function</span>(<span style="font-weight: bold; font-style: italic;">shown</span>, <span style="font-weight: bold; font-style: italic;">layers</span>)
        {
                <span style="font-weight: bold; text-decoration: underline;">this</span>.animatedObjects.setLayer(shown, layers)
                <span style="font-weight: bold; font-style: italic;">// </span><span style="font-weight: bold; font-style: italic;">Drop in an extra draw call here, just in case we are not</span>
                <span style="font-weight: bold; font-style: italic;">// </span><span style="font-weight: bold; font-style: italic;">in the middle of an update loop when this changes</span>
                <span style="font-weight: bold; text-decoration: underline;">this</span>.animatedObjects.draw();
        }
        
        
        <span style="font-weight: bold; text-decoration: underline;">this</span>.setAllLayers = <span style="font-weight: bold;">function</span>(<span style="font-weight: bold; font-style: italic;">layers</span>)
        {
                <span style="font-weight: bold; text-decoration: underline;">this</span>.animatedObjects.setAllLayers(layers);
                <span style="font-weight: bold; font-style: italic;">// </span><span style="font-weight: bold; font-style: italic;">Drop in an extra draw call here, just in case we are not</span>
                <span style="font-weight: bold; font-style: italic;">// </span><span style="font-weight: bold; font-style: italic;">in the middle of an update loop when this changes</span>
                <span style="font-weight: bold; text-decoration: underline;">this</span>.animatedObjects.draw();
        }
         
        
        <span style="font-weight: bold; text-decoration: underline;">this</span>.update = <span style="font-weight: bold;">function</span>()
        {
                
                <span style="font-weight: bold;">if</span> (<span style="font-weight: bold; text-decoration: underline;">this</span>.currentlyAnimating)
                {
                        <span style="font-weight: bold; text-decoration: underline;">this</span>.currFrame = <span style="font-weight: bold; text-decoration: underline;">this</span>.currFrame + 1;
                        <span style="font-weight: bold;">var</span> <span style="font-weight: bold; font-style: italic;">i</span>;
                        <span style="font-weight: bold;">for</span> (i = 0; i &lt; <span style="font-weight: bold; text-decoration: underline;">this</span>.currentBlock.length; i++)
                        {
                                <span style="font-weight: bold;">if</span> (<span style="font-weight: bold; text-decoration: underline;">this</span>.currFrame == <span style="font-weight: bold; text-decoration: underline;">this</span>.animationBlockLength || (<span style="font-weight: bold; text-decoration: underline;">this</span>.currFrame == 1 &amp;&amp; <span style="font-weight: bold; text-decoration: underline;">this</span>.animationBlockLength == 0))
                                {
                                        <span style="font-weight: bold; text-decoration: underline;">this</span>.animatedObjects.setNodePosition(<span style="font-weight: bold; text-decoration: underline;">this</span>.currentBlock[i].objectID,
                                                                                                             <span style="font-weight: bold; text-decoration: underline;">this</span>.currentBlock[i].toX,
                                                                                                             <span style="font-weight: bold; text-decoration: underline;">this</span>.currentBlock[i].toY);
                                }
                                <span style="font-weight: bold;">else</span> <span style="font-weight: bold;">if</span> (<span style="font-weight: bold; text-decoration: underline;">this</span>.currFrame &lt; <span style="font-weight: bold; text-decoration: underline;">this</span>.animationBlockLength)
                                {
                                        <span style="font-weight: bold;">var</span> <span style="font-weight: bold; font-style: italic;">objectID</span> = <span style="font-weight: bold; text-decoration: underline;">this</span>.currentBlock[i].objectID;
                                        <span style="font-weight: bold;">var</span> <span style="font-weight: bold; font-style: italic;">percent</span> = 1 / (<span style="font-weight: bold; text-decoration: underline;">this</span>.animationBlockLength - <span style="font-weight: bold; text-decoration: underline;">this</span>.currFrame);
                                        <span style="font-weight: bold;">var</span> <span style="font-weight: bold; font-style: italic;">oldX</span> = <span style="font-weight: bold; text-decoration: underline;">this</span>.animatedObjects.getNodeX(objectID);
                                        <span style="font-weight: bold;">var</span> <span style="font-weight: bold; font-style: italic;">oldY</span> = <span style="font-weight: bold; text-decoration: underline;">this</span>.animatedObjects.getNodeY(objectID);
                                        <span style="font-weight: bold;">var</span> <span style="font-weight: bold; font-style: italic;">targetX</span> = <span style="font-weight: bold; text-decoration: underline;">this</span>.currentBlock[i].toX;
                                        <span style="font-weight: bold;">var</span> <span style="font-weight: bold; font-style: italic;">targety</span>  = <span style="font-weight: bold; text-decoration: underline;">this</span>.currentBlock[i].toY;                                                
                                        <span style="font-weight: bold;">var</span> <span style="font-weight: bold; font-style: italic;">newX</span> = <span style="font-weight: bold; text-decoration: underline;">this</span>.lerp(<span style="font-weight: bold; text-decoration: underline;">this</span>.animatedObjects.getNodeX(objectID), <span style="font-weight: bold; text-decoration: underline;">this</span>.currentBlock[i].toX, percent);
                                        <span style="font-weight: bold;">var</span> <span style="font-weight: bold; font-style: italic;">newY</span> = <span style="font-weight: bold; text-decoration: underline;">this</span>.lerp(<span style="font-weight: bold; text-decoration: underline;">this</span>.animatedObjects.getNodeY(objectID), <span style="font-weight: bold; text-decoration: underline;">this</span>.currentBlock[i].toY, percent);
                                        <span style="font-weight: bold; text-decoration: underline;">this</span>.animatedObjects.setNodePosition(objectID, newX, newY);
                                }
                        }
                        <span style="font-weight: bold;">if</span> (<span style="font-weight: bold; text-decoration: underline;">this</span>.currFrame &gt;= <span style="font-weight: bold; text-decoration: underline;">this</span>.animationBlockLength)
                        {
                                <span style="font-weight: bold;">if</span> (<span style="font-weight: bold; text-decoration: underline;">this</span>.doingUndo)
                                {
                                        <span style="font-weight: bold;">if</span> (<span style="font-weight: bold; text-decoration: underline;">this</span>.finishUndoBlock(<span style="font-weight: bold; text-decoration: underline;">this</span>.undoStack.pop()))
                                        {
                                                <span style="font-weight: bold; text-decoration: underline;">this</span>.awaitingStep = <span style="font-weight: bold; text-decoration: underline;">true</span>;
                                                <span style="font-weight: bold; text-decoration: underline;">this</span>.fireEvent(<span style="font-style: italic;">"AnimationWaiting"</span>,<span style="font-style: italic;">"NoData"</span>);
                                        }

                                }
                                <span style="font-weight: bold;">else</span>
                                {
                                        <span style="font-weight: bold;">if</span> (<span style="font-weight: bold; text-decoration: underline;">this</span>.animationPaused &amp;&amp; (<span style="font-weight: bold; text-decoration: underline;">this</span>.currentAnimation &lt; <span style="font-weight: bold; text-decoration: underline;">this</span>.AnimationSteps.length))
                                        {
                                                <span style="font-weight: bold; text-decoration: underline;">this</span>.awaitingStep = <span style="font-weight: bold; text-decoration: underline;">true</span>;
                                                <span style="font-weight: bold; text-decoration: underline;">this</span>.fireEvent(<span style="font-style: italic;">"AnimationWaiting"</span>,<span style="font-style: italic;">"NoData"</span>);
                                                <span style="font-weight: bold; text-decoration: underline;">this</span>.currentBlock = [];
                                        }
                                        <span style="font-weight: bold;">else</span>
                                        {
                                                <span style="font-weight: bold; text-decoration: underline;">this</span>.startNextBlock();
                                        }
                                }
                        }
                        <span style="font-weight: bold; text-decoration: underline;">this</span>.animatedObjects.update();          
                
                }

                
        }
        
}

AnimationManager.<span style="font-weight: bold; text-decoration: underline;">prototype</span> = <span style="font-weight: bold;">new</span> <span style="font-weight: bold; text-decoration: underline;">EventListener</span>();
AnimationManager.<span style="font-weight: bold; text-decoration: underline;">prototype</span>.constructor = AnimationManager;

                                
<span style="font-weight: bold;">function</span> <span style="font-weight: bold;">SingleAnimation</span>(<span style="font-weight: bold; font-style: italic;">id</span>, <span style="font-weight: bold; font-style: italic;">fromX</span>, <span style="font-weight: bold; font-style: italic;">fromY</span>, <span style="font-weight: bold; font-style: italic;">toX</span>, <span style="font-weight: bold; font-style: italic;">toY</span>)
{
        <span style="font-weight: bold; text-decoration: underline;">this</span>.objectID = id;
        <span style="font-weight: bold; text-decoration: underline;">this</span>.fromX = fromX;
        <span style="font-weight: bold; text-decoration: underline;">this</span>.fromY = fromY;
        <span style="font-weight: bold; text-decoration: underline;">this</span>.toX = toX;
        <span style="font-weight: bold; text-decoration: underline;">this</span>.toY = toY; 
}
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org875b66f" class="outline-2">
<h2 id="org875b66f"><span class="section-number-2">2</span> Tangle</h2>
<div class="outline-text-2" id="text-2">
<div class="org-src-container">
<pre class="src src-js">&lt;&lt;AnimationMain&gt;&gt;
</pre>
</div>
</div>
</div>
</div>
<div id="postamble" class="status">
<p class="author">Author: VLEAD</p>
<p class="date">Created: 2021-03-17 Wed 07:41</p>
<p class="validation"><a href="http://validator.w3.org/check?uri=referer">Validate</a></p>
</div>
</body>
</html>
